(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{432:function(e,t,r){e.exports=r.p+"assets/img/image-20220613110241749.34fc4913.png"},433:function(e,t,r){e.exports=r.p+"assets/img/ebpf.729f8e44.png"},434:function(e,t,r){e.exports=r.p+"assets/img/envoy.088dccd2.png"},435:function(e,t,r){e.exports=r.p+"assets/img/ebpf_conspros.0c7501f3.png"},436:function(e,t,r){e.exports=r.p+"assets/img/envoy_conspros.d9f6376c.png"},437:function(e,t,r){e.exports=r.p+"assets/img/basic_topo.402ecd8e.png"},438:function(e,t,r){e.exports=r.p+"assets/img/image-20220613112102559.6863aed8.png"},439:function(e,t,r){e.exports=r.p+"assets/img/iptable_scalebility.c4ba69c8.png"},440:function(e,t,r){e.exports=r.p+"assets/img/compare.0a43de21.png"},441:function(e,t,r){e.exports=r.p+"assets/img/cilium_scalability.238251bd.png"},442:function(e,t,r){e.exports=r.p+"assets/img/cilium_deeper1.76e65a04.png"},443:function(e,t,r){e.exports=r.p+"assets/img/cilium_deeper2.63e86dcb.png"},444:function(e,t,r){e.exports=r.p+"assets/img/cilium_deeper3.9b2cd140.png"},445:function(e,t,r){e.exports=r.p+"assets/img/cilium_deeper4.d22f497f.png"},446:function(e,t,r){e.exports=r.p+"assets/img/cilium_deeper5.cbbfa713.png"},518:function(e,t,r){"use strict";r.r(t);var s=r(12),i=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p"),s("div",{staticClass:"table-of-contents"},[s("ul")]),s("p"),e._v(" "),s("p",[e._v("最近吃饭的时候看了 CNCF 20 的两个 Webinar，都是和 eBPF、Envoy 相关的，两年前的视频但是还是很有意思的。连带讨论时间还是挺长的，都在一个小时左右，记录下重点内容。")]),e._v(" "),s("h1",{attrs:{id:"comparing-ebpf-and-istio-envoy-for-monitoring-microservice-interactions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#comparing-ebpf-and-istio-envoy-for-monitoring-microservice-interactions"}},[e._v("#")]),e._v(" "),s("a",{attrs:{href:"https://www.youtube.com/watch?v=Wocn6DK3FfM",target:"_blank",rel:"noopener noreferrer"}},[e._v("Comparing eBPF and Istio/Envoy for Monitoring Microservice Interactions"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("演讲者来自 Flowmill，一家观测性初创公司，好像已经被 Splunk 收购了。")]),e._v(" "),s("p",[e._v("首先是使用 service mesh 的一些好处：流量管理、安全性、可观测性")]),e._v(" "),s("p",[e._v("接着介绍了 Envoy  的 sidecar 架构")]),e._v(" "),s("p",[s("img",{attrs:{src:r(432),alt:""}})]),e._v(" "),s("p",[e._v("为什么他们会选择使用 eBPF 做可观测性")]),e._v(" "),s("p",[e._v("Envoy/Istio 是为应用层设计的，所以下层的 metrics 并不全面。")]),e._v(" "),s("p",[e._v("演讲者还用 "),s("a",{attrs:{href:"https://github.com/GoogleCloudPlatform/microservices-demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("GoogleCloudPlatform/microservices-demo"),s("OutboundLink")],1),e._v(" 跑了个 benchmark，然后发现监控的开销降低了不少。这里信息其实不是很完善，所以提问环节也有人质疑了这个开销，问到了有没有可能是因为 envoy/istio 加了 tls 支持，加密解密带来的。回复是没有去具体考虑什么组件带来了开销，是直接使用的默认配置，想要表现开箱即用的情况下二者的差距。")]),e._v(" "),s("p",[s("img",{attrs:{src:r(433),alt:""}})]),e._v(" "),s("p",[s("img",{attrs:{src:r(434),alt:""}})]),e._v(" "),s("p",[e._v("最后总结下，在项目中使用两者的取舍")]),e._v(" "),s("p",[s("img",{attrs:{src:r(435),alt:""}})]),e._v(" "),s("p",[s("img",{attrs:{src:r(436),alt:""}})]),e._v(" "),s("h1",{attrs:{id:"how-cilium-uses-bpf-to-supercharge-kubernetes-networking-security"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-cilium-uses-bpf-to-supercharge-kubernetes-networking-security"}},[e._v("#")]),e._v(" "),s("a",{attrs:{href:"https://www.youtube.com/watch?v=sodtj1RPjlY",target:"_blank",rel:"noopener noreferrer"}},[e._v("How Cilium uses BPF to Supercharge Kubernetes Networking & Security"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("这个感觉更好看一些，是来自 SUSE 的工程师介绍他们为什么会选用 Cilium 做 K8S 中的网络控制，Cilium 的公司 Isovalent 的创始人也来做了个报告。")]),e._v(" "),s("blockquote",[s("p",[e._v("引用自博客 "),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/446660758",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cilium eBPF实现机制源码分析"),s("OutboundLink")],1),e._v("，写得很好")]),e._v(" "),s("p",[e._v("Cilium是由革命性内核技术eBPF驱动，用于提供、保护和观察容器工作负载（云原生）之间的网络连接的网络组件。 Cilium使用eBPF的强大功能来加速网络，并在Kubernetes中提供安全性和可观测性。现在 Cilium将eBPF的优势带到了Service Mesh的世界。Cilium服务网格使用eBPF来管理连接，实现了服务网格必备的流量管理、安全性和可观测性。")])]),e._v(" "),s("p",[e._v("首先 SUSE 工程师说一下大背景，下面是他们使用 K8S 后的架构，控制面要提供 DNS-Aware 的管理方式")]),e._v(" "),s("p",[s("img",{attrs:{src:r(437),alt:""}})]),e._v(" "),s("p",[e._v("接着是说用 iptables 有什么问题，与之相对 cilium 有什么好处：")]),e._v(" "),s("ul",[s("li",[e._v("规则一条条写起来很麻烦，而且容易写错")]),e._v(" "),s("li",[e._v("如果 ip 是动态的时候，添加规则就更加麻烦了，特别是在实例重启之后")])]),e._v(" "),s("p",[s("img",{attrs:{src:r(438),alt:"image-20220613112102559"}})]),e._v(" "),s("ul",[s("li",[e._v("性能差，链表存储规则，过滤一次太慢了，特别是你规则很多的时候")]),e._v(" "),s("li",[e._v("得为集群中每个实例设置相同规则的时候拓展性很差")])]),e._v(" "),s("p",[s("img",{attrs:{src:r(439),alt:""}})]),e._v(" "),s("p",[e._v("与之相比，Cilium 要好很多，它为你做了很多脏活累活儿，还可以支持 DNS-Aware 的管理方式")]),e._v(" "),s("p",[s("img",{attrs:{src:r(440),alt:""}})]),e._v(" "),s("p",[e._v("同时它的拓展性很好，毕竟 BPF Map 都是哈希表，规则的查询插入都快很多")]),e._v(" "),s("p",[s("img",{attrs:{src:r(441),alt:""}})]),e._v(" "),s("p",[e._v("下面就是具体解释这种优势的来源：减少了 Envoy sidecar架构下的开销。事实上 Cilium 提出了更加激进的做法：彻底推翻了现有服务网格代理中常见的 sidecar 范式，想要把服务网格代理迁移到内核层面，具体可以参考这篇博客： "),s("a",{attrs:{href:"https://isovalent.com/blog/post/2021-12-08-ebpf-servicemesh",target:"_blank",rel:"noopener noreferrer"}},[e._v("How eBPF will solve Service Mesh - Goodbye Sidecars "),s("OutboundLink")],1),e._v("。对此也不乏质疑之声，另有一篇文章讨论这种争议："),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/456214160",target:"_blank",rel:"noopener noreferrer"}},[e._v("eBPF 和 Wasm：探索服务网格数据平面的未来"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("p",[s("img",{attrs:{src:r(442),alt:""}})]),e._v(" "),s("p",[e._v("Cilium 替你干了很多事：多个 cluster 间可以方便地实现全局路由")]),e._v(" "),s("p",[s("img",{attrs:{src:r(443),alt:""}})]),e._v(" "),s("p",[e._v("Cilium 替你干了很多事：可以方便地进行安全通讯")]),e._v(" "),s("p",[s("img",{attrs:{src:r(444),alt:""}})]),e._v(" "),s("p",[e._v("Cilium 替你干了很多事：可以方便地指定各类应用层协议的规则")]),e._v(" "),s("p",[s("img",{attrs:{src:r(445),alt:""}})]),e._v(" "),s("p",[e._v("Cilium 替你干了很多事：可以方便地管理消息队列、数据库")]),e._v(" "),s("p",[s("img",{attrs:{src:r(446),alt:""}})]),e._v(" "),s("p",[e._v("Isovalent 创始人讲的就比较基础的 ebpf 相关内容了，这里不再记录。但是提到了一个很有趣的内容，"),s("a",{attrs:{href:"https://github.com/cilium/cilium/projects/34",target:"_blank",rel:"noopener noreferrer"}},[e._v("BPF templating"),s("OutboundLink")],1),e._v("，但是好像目前还没有实现。")]),e._v(" "),s("p",[e._v("题外话：Isovalent 关于 Cilium 的工作做的很棒，而且他们的 eBPF 教学文档写得很详细，也一直在维护 golang 的 ebpf 包 👍。")]),e._v(" "),s("Comment",{attrs:{lang:"zh-CN"}})],1)}),[],!1,null,null,null);t.default=i.exports}}]);