<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>虚拟化基础学习笔记 | Blog</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/ionicons/2.0.1/css/ionicons.min.css">
    <script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.5f87357d.css" as="style"><link rel="preload" href="/assets/js/app.f299d9eb.js" as="script"><link rel="preload" href="/assets/js/1.489a6dc0.js" as="script"><link rel="preload" href="/assets/js/9.c640c61b.js" as="script"><link rel="preload" href="/assets/js/13.e56158ac.js" as="script"><link rel="prefetch" href="/assets/js/10.0a8552e5.js"><link rel="prefetch" href="/assets/js/11.7544d912.js"><link rel="prefetch" href="/assets/js/12.4abf2689.js"><link rel="prefetch" href="/assets/js/14.84181d18.js"><link rel="prefetch" href="/assets/js/15.dab14606.js"><link rel="prefetch" href="/assets/js/16.98da8228.js"><link rel="prefetch" href="/assets/js/17.0ba0e8e3.js"><link rel="prefetch" href="/assets/js/18.d2c98111.js"><link rel="prefetch" href="/assets/js/19.86bdbfa9.js"><link rel="prefetch" href="/assets/js/20.22caf17f.js"><link rel="prefetch" href="/assets/js/21.c75712be.js"><link rel="prefetch" href="/assets/js/22.c0c99274.js"><link rel="prefetch" href="/assets/js/23.214355cd.js"><link rel="prefetch" href="/assets/js/24.a9557518.js"><link rel="prefetch" href="/assets/js/25.fb756fe5.js"><link rel="prefetch" href="/assets/js/26.88bc672c.js"><link rel="prefetch" href="/assets/js/27.a047953c.js"><link rel="prefetch" href="/assets/js/28.0aa927b7.js"><link rel="prefetch" href="/assets/js/29.599475e0.js"><link rel="prefetch" href="/assets/js/3.db885a38.js"><link rel="prefetch" href="/assets/js/30.ac4304d9.js"><link rel="prefetch" href="/assets/js/31.378fb91c.js"><link rel="prefetch" href="/assets/js/32.72e1c0ea.js"><link rel="prefetch" href="/assets/js/33.358b985a.js"><link rel="prefetch" href="/assets/js/34.92d54470.js"><link rel="prefetch" href="/assets/js/35.3ee5ae15.js"><link rel="prefetch" href="/assets/js/36.f3bd4bb7.js"><link rel="prefetch" href="/assets/js/37.27456d40.js"><link rel="prefetch" href="/assets/js/38.ac3e3512.js"><link rel="prefetch" href="/assets/js/39.623032e6.js"><link rel="prefetch" href="/assets/js/4.5ebe3061.js"><link rel="prefetch" href="/assets/js/40.81db8d94.js"><link rel="prefetch" href="/assets/js/41.dcc11868.js"><link rel="prefetch" href="/assets/js/42.5ad0c9c8.js"><link rel="prefetch" href="/assets/js/43.d8a7f45f.js"><link rel="prefetch" href="/assets/js/44.78c0feaa.js"><link rel="prefetch" href="/assets/js/45.1b1f0dc8.js"><link rel="prefetch" href="/assets/js/46.eed83510.js"><link rel="prefetch" href="/assets/js/47.6eac4cc5.js"><link rel="prefetch" href="/assets/js/48.b7e6b32a.js"><link rel="prefetch" href="/assets/js/49.bbb7666a.js"><link rel="prefetch" href="/assets/js/5.86d38cb0.js"><link rel="prefetch" href="/assets/js/50.2f8f6c98.js"><link rel="prefetch" href="/assets/js/51.cd539748.js"><link rel="prefetch" href="/assets/js/52.a4605abf.js"><link rel="prefetch" href="/assets/js/53.027cd8a1.js"><link rel="prefetch" href="/assets/js/54.d7e6f527.js"><link rel="prefetch" href="/assets/js/55.fdbf2d23.js"><link rel="prefetch" href="/assets/js/56.b88cb66b.js"><link rel="prefetch" href="/assets/js/57.eaebbeb1.js"><link rel="prefetch" href="/assets/js/58.a8aab8e9.js"><link rel="prefetch" href="/assets/js/59.2fd0e12e.js"><link rel="prefetch" href="/assets/js/6.834bec42.js"><link rel="prefetch" href="/assets/js/60.1602d25a.js"><link rel="prefetch" href="/assets/js/61.cf2b696f.js"><link rel="prefetch" href="/assets/js/62.8659cf17.js"><link rel="prefetch" href="/assets/js/63.00655be8.js"><link rel="prefetch" href="/assets/js/64.669e347b.js"><link rel="prefetch" href="/assets/js/65.2bf8094b.js"><link rel="prefetch" href="/assets/js/66.327070d4.js"><link rel="prefetch" href="/assets/js/67.810b2fee.js"><link rel="prefetch" href="/assets/js/68.e3476a72.js"><link rel="prefetch" href="/assets/js/69.35da038b.js"><link rel="prefetch" href="/assets/js/7.edffe57c.js"><link rel="prefetch" href="/assets/js/70.75827cae.js"><link rel="prefetch" href="/assets/js/71.225214a5.js"><link rel="prefetch" href="/assets/js/72.a84f7192.js"><link rel="prefetch" href="/assets/js/73.ffe311be.js"><link rel="prefetch" href="/assets/js/74.3b69b9c2.js"><link rel="prefetch" href="/assets/js/75.aaf712aa.js"><link rel="prefetch" href="/assets/js/76.c3292f62.js"><link rel="prefetch" href="/assets/js/77.7fb25a78.js"><link rel="prefetch" href="/assets/js/8.2fb98e50.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5f87357d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/title.png" alt="Blog" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/zh/about-me/" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/blogs/" class="nav-link router-link-active">
  所有博客
</a></li><li class="dropdown-item"><!----> <a href="/zh/blogs/category/" class="nav-link">
  标签分类
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/blogs/20210226/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/Forsworns/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/zh/about-me/" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/blogs/" class="nav-link router-link-active">
  所有博客
</a></li><li class="dropdown-item"><!----> <a href="/zh/blogs/category/" class="nav-link">
  标签分类
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/blogs/20210226/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/Forsworns/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#虚拟化和hypervisor">虚拟化和Hypervisor</a><ul><li><a href="#hypervisor分类">Hypervisor分类</a></li><li><a href="#hypervisor-构成">Hypervisor 构成</a></li><li><a href="#linux-hypervisor">Linux hypervisor</a></li><li><a href="#qemu">QEMU</a></li></ul></li><li><a href="#virtio">Virtio</a><ul><li><a href="#全虚拟化和半虚拟化">全虚拟化和半虚拟化</a></li><li><a href="#linux-guest的抽象">Linux guest的抽象</a></li><li><a href="#virtio-架构">Virtio 架构</a></li><li><a href="#概念框架">概念框架</a></li><li><a href="#virtio-buffer">Virtio buffer</a></li><li><a href="#core-api">Core API</a></li><li><a href="#virtio-vring">Virtio Vring</a></li></ul></li><li><a href="#docker">Docker</a></li><li><a href="#reference">Reference</a></li></ul></div><p></p> <h1 id="虚拟化基础学习笔记"><a href="#虚拟化基础学习笔记" class="header-anchor">#</a> 虚拟化基础学习笔记</h1> <h2 id="虚拟化和hypervisor"><a href="#虚拟化和hypervisor" class="header-anchor">#</a> 虚拟化和Hypervisor</h2> <p>这部分主要抄录自<a href="#ref1"><sup>[1]</sup></a>。这部分首先介绍虚拟化和 hypervisor ，再探索两个基于 Linux 的 hypervisor：KVM 和 Lguest，再探索 QEMU。</p> <p>虚拟化就是通过某种方式隐藏底层物理硬件的过程，从而让多个操作系统可以透明地使用和共享它。这种架构的另一个更常见的名称是平台虚拟化。下图就展示了该分层架构。</p> <p><img src="data:image/gif;base64,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" alt="常用硬件虚拟化的简单分层架构"></p> <p>平台虚拟化的好处很多。美国环境保护署（EPA）报告的一组有趣的统计数据就证明了其好处。EPA 研究服务器和数据中心的能源效率时发现，实际上服务器只有 5% 的时间是在工作的。在其他时间，服务器都处于 “休眠” 状态。在单个服务器上的虚拟化平台能够改善服务器的利用率，但是减少服务器的数量才是它的最大功用。减少服务器数量意味着减少不动资产、能耗、冷却和管理成本。使用更少的硬件还能提高可靠性。</p> <p>hypervisor 是一种运行在物理服务器和操作系统之间的中间层软件，可以允许多个操作系统和应用共享一套基础物理硬件。可以将hypervisor 看做是虚拟环境中的“元”操作系统，可以协调访问服务器上的所有物理设备和虚拟机，所以又称为虚拟机监视器（virtual machine monitor）。hypervisor 是所有虚拟化技术的核心，非中断的支持多工作负载迁移是 hypervisor 的基本功能。当服务器启动并执行 hypervisor 时，会给每一台虚拟机分配适量的内存，cpu，网络和磁盘资源，并且加载所有虚拟机的客户操作系统。</p> <h3 id="hypervisor分类"><a href="#hypervisor分类" class="header-anchor">#</a> Hypervisor分类</h3> <p>hypervisor 可以划分为两大类。首先是类型 1，这种 hypervisor 是直接运行在物理硬件之上的。其次是类型 2，这种 hypervisor 运行在另一个操作系统（运行在物理硬件之上）中。类型 1 hypervisor 的一个例子是基于内核的虚拟机（KVM —— 它本身是一个基于操作系统的 hypervisor）。类型 2 hypervisor 包括 QEMU 和 WINE。</p> <h3 id="hypervisor-构成"><a href="#hypervisor-构成" class="header-anchor">#</a> Hypervisor 构成</h3> <p>hypervisor（不管是什么类型）仅是一个从其来宾操作系统抽象机器硬件的分层应用程序。通过这种方式，每个来宾操作系统看到的仅是一个 VM 而不是真实的硬件机器。我们大致看一下 hypervisor 的内部组成，以及它在 VM（来宾操作系统）上的表示。</p> <p>hypervisor 需要少量设施启动来宾操作系统：一个需要驱动的内核映像、一个配置（比如 IP 地址和所需的内存量）、一个磁盘盒一个网络设备。磁盘和网络设备通常映射到机器的物理磁盘和网络设备（如下图所示）。最后，需要使用一组来宾操作系统工具启动和管理来宾操作系统。</p> <p><img src="data:image/gif;base64,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" alt="hypervisor 中的最小资源映射"></p> <p>然后，一个简化的 hypervisor 架构实现最后的关键功能，从而使来宾操作系统可以和宿主操作系统同时运行。实现这个功能需要一些特定的要素，如下图所示。首先，类似于将用户空间应用程序和内核函数连接起来的系统调用，一个通常可用的虚拟化调用（hapercall，hypervisor 对操作系统进行的系统调用）层允许来宾系统向宿主操作系统发出请求。可以在内核中虚拟化 I/O，或通过来宾操作系统的代码支持它。故障必须由 hypervisor 亲自处理，从而解决实际的故障，或将虚拟设备故障发送给来宾操作系统。hypervisor 还必须处理在来宾操作系统内部发生的异常。（毕竟，来宾操作系统发生的错误仅会停止该系统，而不会影响 hypervisor 或其他来宾操作系统）。hypervisor 的核心要素之一是页映射器，它将硬件指向特定操作系统（来宾或 hypervisor）的页。最后，需要使用一个高级别的调度器在hypervisor和来宾操作系统之间传输控制。</p> <p><img src="data:image/gif;base64,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" alt="简化的基于 Linux 的hypervisor"></p> <h4 id="kvm"><a href="#kvm" class="header-anchor">#</a> KVM</h4> <p>KVM （Kernel-based Virtual Machine）针对运行在 x86 硬件硬件上的、驻留在内核中的虚拟化基础结构。KVM 是第一个成为原生 Linux 内核（2.6.20）的一部分的 hypervisor。</p> <p><img src="data:image/gif;base64,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" alt="KVM hypervisor的高级别视图"></p> <p>KVM 在平台虚拟化中利用 QEMU，并使用 Linux 作为hypervisor，因此实现了这个构思，即让来宾操作系统能够和其他 Linux 应用程序协调执行。</p> <h4 id="lguest"><a href="#lguest" class="header-anchor">#</a> Lguest</h4> <p><img src="data:image/gif;base64,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" alt="实现 x86 准虚拟化的 Lguest 的架构"></p> <h3 id="linux-hypervisor"><a href="#linux-hypervisor" class="header-anchor">#</a> Linux hypervisor</h3> <p>下面讨论两个基于 Linux 的 hypervisor。</p> <h3 id="qemu"><a href="#qemu" class="header-anchor">#</a> QEMU</h3> <p>这部分主要抄录自<a href="#Reference"><sup>[2]</sup></a>。</p> <p>QEMU 是一个系统模拟器，不仅提供访客系统的虚拟化平台，还提供了整个系统的虚拟化，包括 PCI host controller，disk，network，video hardware，USB controller 和其他硬件设施。</p> <h2 id="virtio"><a href="#virtio" class="header-anchor">#</a> Virtio</h2> <p>这部分主要翻译自<a href="#Reference"><sup>[3]</sup></a>。</p> <p>简而言之，Virtio 是一个半虚拟化 hypervisor 中的虚拟设备之上的一个抽象层。 virtio 是由 Rusty Russell 开发的，最初的目的是支持上面提到的，他自己开发的虚拟化方案 lguest。我们先讨论一下半虚拟化和虚拟设备，然后探索 virtio的实现细节，我们关注的是 2.6.30 内核中的virtio框架。</p> <p>Linux 提供了大量各有优劣的实现 hypervisor 的方案，诸如 KVM，lguest 和 User-mode Linux。有了这些不同的方案，可以按需选择，比如各种虚拟化外设。virtio 提供了一个统一的前端来进行外设虚拟化，提供了标准化的接口来提高不同平台代码的重用性。</p> <h3 id="全虚拟化和半虚拟化"><a href="#全虚拟化和半虚拟化" class="header-anchor">#</a> 全虚拟化和半虚拟化</h3> <p>让我们讨论一下两类虚拟化机制：全虚拟化和半虚拟化。在全虚拟化中，访客系统运行在完全虚拟的环境中，但是他不知道自己是在虚拟环境下，不需要进行特殊的配置。相对的，半虚拟化中，访客操作系统不仅知道他是在 hypervisor 中运行，而且它还会提供代码使得 guest-to-hypervisor 的转换更加高效。</p> <p>在全虚拟化机制下，hypervisor 必须模拟外设硬件，模拟最底层的信息，比如模拟一个网卡驱动。尽管在这层抽象下的虚拟化是彻底而纯净的，它也是最低效和极度复杂的一种虚拟化方案。在半虚拟化机制下，访客和 hypervisor 能够配合地让虚拟化更加高效，它的缺陷是操作系统知道自己是运行在虚拟化系统上的，需要进行改动。</p> <p><img src="data:image/gif;base64,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" alt="全虚拟化和半虚拟化中的设备虚拟化"></p> <p>上图中，在传统的全虚拟化环境中，在访客系统发出请求时，hypervisor 需要陷入 trap 中，然后去模拟硬件的行为。尽管这样更具扩展性，能够允许不加改动的操作系统运行为访客系统，但是不够高效。上图右边的半虚拟化环境下，访客操作系统明白它运行在 hypervisor 上，它知道自己有前端驱动，hypervisor 则负责实现了特定外设的驱动后端。这些前后端驱动就是 virtio 的来源，它为虚拟设备提供了标准化的接口，提升开发效率和代码复用率。</p> <h3 id="linux-guest的抽象"><a href="#linux-guest的抽象" class="header-anchor">#</a> Linux guest的抽象</h3> <p>在之前的章节中，我们看到 virtio 是半虚拟化 hypervisor 中一系列常见的虚拟设备的抽象。这种设计允许 hypervisor 向外暴露一系列常见的虚拟化设备，并提供公共 API。下图就解释了它的重要性。借助半虚拟化 hypervisor，访客实现了一系列公共的接口，特定的外设则被后端的驱动所模拟。后端驱动并不必是公共的，只要他们能够实现前端需要的行为就行了。</p> <p><img src="data:image/gif;base64,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" alt="Driver abstractions with virtio"></p> <p>注意在真实环境下，外设的虚拟化发生在用户空间，使用的是 QEMU，所以后端驱动借助 QEMU 和 hypervisor 的用户空间来通信并管理设备的 I/O 。</p> <p>virtio 的 API 依赖于一个简单的 buffer 抽象，来包裹访客需要的命令和数据。让我们深入 virtio API 和他的组成部分。</p> <h3 id="virtio-架构"><a href="#virtio-架构" class="header-anchor">#</a> Virtio 架构</h3> <p>除了在访客中实现的前端驱动和 hypervisor 中实现的后端驱动，virtio 还定义了两层来实现 guest-to-hypervisor 的通信。在最上层（也叫作 virtio）是虚拟队列接口，将前端和后端联系起来。驱动能够使用 0 或多个队列，取决于他们的需求。例如，virtio 网络驱动使用两个虚拟队列（一个接受，另一个传输），而 virtio block 驱动就只使用一个。虚拟队列实际上成环状的，但是也不是必须如此，只要前后端保持一致就行了。</p> <p><img src="data:image/gif;base64,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" alt="High-level architecture"></p> <p>上图中罗列了五个前端驱动，即block devices (例如磁盘)，network devices，PCI emulation，balloon driver (用来动态管理访客的内存使用) 和 console driver。每个前端驱动都有一个对应的后端驱动。</p> <h3 id="概念框架"><a href="#概念框架" class="header-anchor">#</a> 概念框架</h3> <p>从访客的视角来看，下图定义了 object hierarchy。在最上方的是 virtio_driver，它代表了访客的前端驱动。符合这个驱动的设备被封装成了 virtio_device（一种访客中的设备表示形式）。它与 virtio_config_ops 结构有关，该结构则负责定义和配置 virtio device的行为。virtqueue 又关联到了 virtio_device，在服务时维护一个对设备的引用。最后每个 virtqueue 对象引用了 virtqueue_ops 对象，该对象定义了底层队列用来服务 hypervisor 驱动的行为。</p> <p><img src="/assets/img/hierarchy.0e14c33e.gif" alt="Object hierarchy of the Virtio front end"></p> <p>进程在一开始会创建一个 virtio driver，然后通过 register_virtio_driver 来注册它。 virtio_driver 结构定义了上层设备驱动，列出了驱动至此的设备的 ID，一个支持的特性的表（取决于外设的类型）以及一系列回调函数。当 hypervisor 在设备列表中识别出来一个匹配设备ID的新设备，就会调用 probe 函数来传输 virtio_device 对象（该函数在virtio_driver 对象中提供）。该对象和管理外设使用的数据（这和特定的驱动有关）一起被缓存下来。取决于外设的类型，virtio_config_ops函数可能会被触发，来读取或设置外设特定的选项。例如，从一个 virtio_blk 设备获取硬盘的读写状态，或是设置 block device 的 block size。</p> <p>注意 virtio_device 不会包含 virtqueue 的引用 （但是 virtqueue 确实引用了virtio_device）。为了识别和 virtqueue 相关联的 virtio_device，你可以使用 virtio_config_ops 对象的 find_vq 函数。这个对象会返回和 virtio_device 实例相关的虚拟队列。find_vq 函数也会允许给 virtqueue 提供回调函数的特化，用来告知访客系统来自 hyperviso 的 response buffer。</p> <p>virtqueue 是一个简单的结构，声明了一个额外的回调函数（该回调函数会在 hypervisor 消耗掉 buffer中的数据时候调用），一个 virtio_device 的引用，一个 virtqueue_ops 的引用和一个特殊的 priv 引用指向了要使用的底层实现。尽管回调函数是可选的，也可以动态启用或禁用该回调。</p> <p>但是该结构的核心是 virtqueue_ops，它定义了指令和数据是怎样在访客和 hypervisor之间移动的。让我们看看如何向队列添加或删除对象。</p> <h3 id="virtio-buffer"><a href="#virtio-buffer" class="header-anchor">#</a> Virtio buffer</h3> <p>前端驱动和后端驱动是通过 buffer 来交流的。对于一个 I/O 请求，访客提供一个或多个 buffer 来表示它。例如，你可以提供三个 buffer，第一个代表一个读请求、之后的两个代表对应的响应数据。在内部，该配置是使用 scatter-gather list 来表示的，列表的每一项都是一个地址和一个长度。</p> <h3 id="core-api"><a href="#core-api" class="header-anchor">#</a> Core API</h3> <h3 id="virtio-vring"><a href="#virtio-vring" class="header-anchor">#</a> Virtio Vring</h3> <p>详见  <a href="#Reference"><sup>[4]</sup></a> 。</p> <h2 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h2> <h2 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h2> <ol><li><a href="https://www.ibm.com/developerworks/cn/linux/l-hypervisor/" target="_blank" rel="noopener noreferrer">剖析 Linux hypervisor<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <div id="ref1"></div></li> <li>https://www.cnblogs.com/echo1937/p/7138294.html</li> <li><a href="https://developer.ibm.com/articles/l-virtio/" target="_blank" rel="noopener noreferrer">Virtio: An I/O virtualization framework for Linux<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/yi-mu-xi/p/12544695.html" target="_blank" rel="noopener noreferrer">virtio之vring<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.linuxprobe.com/docker-and-vm.html" target="_blank" rel="noopener noreferrer">容器、虚拟机与Docker概念全解析<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/12/26 上午11:00:37</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f299d9eb.js" defer></script><script src="/assets/js/1.489a6dc0.js" defer></script><script src="/assets/js/9.c640c61b.js" defer></script><script src="/assets/js/13.e56158ac.js" defer></script>
  </body>
</html>
