<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Makefile 笔记 | Sharlayan</title>
    <meta name="description" content="人傻就要多记笔记">
    <link rel="preload stylesheet" href="/assets/style.3ef9b918.css" as="style">
    <link rel="modulepreload" href="/assets/chunks/VPAlgoliaSearchBox.5642e930.js">
    <link rel="modulepreload" href="/assets/app.6da136a8.js">
    <link rel="modulepreload" href="/assets/zh_blogs_20210409_index.md.26b10045.lean.js">
    
    <script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.staticfile.org/ionicons/2.0.1/css/ionicons.min.css">
  <link rel="icon" type="image/png" href="/logo.png">
  <meta name="author" content="Peihao Yang">
  <meta property="og:title" content="Home">
  <meta property="og:description" content="Home of Peihao Yang">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><!--[--><div class="Layout" data-v-b617430f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-d4120332></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-d4120332> Skip to content </a><!--]--><!----><header class="VPNav no-sidebar" data-v-b617430f data-v-aa1cde23><div class="VPNavBar" data-v-aa1cde23 data-v-cbdd8588><div class="container" data-v-cbdd8588><div class="title" data-v-cbdd8588><div class="VPNavBarTitle" data-v-cbdd8588 data-v-730d6dd1><a class="title" href="/zh/" data-v-730d6dd1><!--[--><!--]--><!--[--><img class="VPImage logo" src="/assets/logo.png" alt data-v-0f13a436><!--]--><!----><!--[--><!--]--></a></div></div><div class="content" data-v-cbdd8588><div class="curtain" data-v-cbdd8588></div><!--[--><!--]--><div class="VPNavBarSearch search" data-v-cbdd8588 style="--699c4559:&#39;Meta&#39;;"><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-cbdd8588 data-v-2d3a777e><span id="main-nav-aria-label" class="visually-hidden" data-v-2d3a777e>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh/" data-v-2d3a777e data-v-f559a019 data-v-1a0f9836><!--[-->🏡主页<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh/about-me/" data-v-2d3a777e data-v-f559a019 data-v-1a0f9836><!--[-->🦹‍♂️关于我<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-2d3a777e data-v-fc33d832><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-fc33d832><span class="text" data-v-fc33d832><!----> 📓博客 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-fc33d832><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-fc33d832><div class="VPMenu" data-v-fc33d832 data-v-ecf4e7d9><div class="items" data-v-ecf4e7d9><!--[--><!--[--><div class="VPMenuLink" data-v-ecf4e7d9 data-v-c7da634f><a class="VPLink link" href="/zh/blogs/" data-v-c7da634f data-v-1a0f9836><!--[-->📃所有博客<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ecf4e7d9 data-v-c7da634f><a class="VPLink link" href="/zh/blogs/tags/" data-v-c7da634f data-v-1a0f9836><!--[-->🔖标签分类<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://forsworns.github.io/feed.xml" target="_blank" rel="noreferrer" data-v-2d3a777e data-v-f559a019 data-v-1a0f9836><!--[-->🔥RSS<!--]--><!----></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-cbdd8588 data-v-7cdc304e data-v-fc33d832><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-fc33d832><span class="text" data-v-fc33d832><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="option-icon" data-v-fc33d832><path d="M0 0h24v24H0z" fill="none"></path><path d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z " class="css-c4d79v"></path></svg>  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-fc33d832><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-fc33d832><div class="VPMenu" data-v-fc33d832 data-v-ecf4e7d9><!----><!--[--><!--[--><div class="items" data-v-7cdc304e><p class="title" data-v-7cdc304e>中文</p><!--[--><div class="VPMenuLink" data-v-7cdc304e data-v-c7da634f><a class="VPLink link" href="/" data-v-c7da634f data-v-1a0f9836><!--[-->English<!--]--><!----></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-cbdd8588 data-v-7f24c201><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-7f24c201 data-v-2b897f09 data-v-ab7cdc04><span class="check" data-v-ab7cdc04><span class="icon" data-v-ab7cdc04><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-2b897f09><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-2b897f09><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-cbdd8588 data-v-a5afa74d data-v-80c99471><!--[--><a class="VPSocialLink" href="https://github.com/forsworns/blog-vitepress" target="_blank" rel="noopener" data-v-80c99471 data-v-51b6609b><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="mailto:peihao.young@gmail.com" target="_blank" rel="noopener" data-v-80c99471 data-v-51b6609b><svg role="img" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20">
            <path d="M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z" ></path>
            </svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-cbdd8588 data-v-e459e5dc data-v-fc33d832><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-fc33d832><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-fc33d832><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-fc33d832><div class="VPMenu" data-v-fc33d832 data-v-ecf4e7d9><!----><!--[--><!--[--><div class="group" data-v-e459e5dc><p class="trans-title" data-v-e459e5dc>中文</p><!--[--><div class="VPMenuLink" data-v-e459e5dc data-v-c7da634f><a class="VPLink link" href="/" data-v-c7da634f data-v-1a0f9836><!--[-->English<!--]--><!----></a></div><!--]--></div><div class="group" data-v-e459e5dc><div class="item appearance" data-v-e459e5dc><p class="label" data-v-e459e5dc>Appearance</p><div class="appearance-action" data-v-e459e5dc><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e459e5dc data-v-2b897f09 data-v-ab7cdc04><span class="check" data-v-ab7cdc04><span class="icon" data-v-ab7cdc04><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-2b897f09><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-2b897f09><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e459e5dc><div class="item social-links" data-v-e459e5dc><div class="VPSocialLinks social-links-list" data-v-e459e5dc data-v-80c99471><!--[--><a class="VPSocialLink" href="https://github.com/forsworns/blog-vitepress" target="_blank" rel="noopener" data-v-80c99471 data-v-51b6609b><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="mailto:peihao.young@gmail.com" target="_blank" rel="noopener" data-v-80c99471 data-v-51b6609b><svg role="img" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20">
            <path d="M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z" ></path>
            </svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-cbdd8588 data-v-d6834c14><span class="container" data-v-d6834c14><span class="top" data-v-d6834c14></span><span class="middle" data-v-d6834c14></span><span class="bottom" data-v-d6834c14></span></span></button></div></div></div><!----></header><!----><!----><div class="VPContent" id="VPContent" data-v-b617430f data-v-f32377af><div class="VPDoc has-aside" data-v-f32377af data-v-1e970af1><div class="container" data-v-1e970af1><div class="aside" data-v-1e970af1><div class="aside-curtain" data-v-1e970af1></div><div class="aside-container" data-v-1e970af1><div class="aside-content" data-v-1e970af1><div class="VPDocAside" data-v-1e970af1 data-v-b1723386><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-b1723386 data-v-0980ba1d><div class="content" data-v-0980ba1d><div class="outline-marker" data-v-0980ba1d></div><div class="outline-title" data-v-0980ba1d>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-0980ba1d><span class="visually-hidden" id="doc-outline-aria-label" data-v-0980ba1d> Table of Contents for current page </span><ul class="root" data-v-0980ba1d data-v-6f4caaf4><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-b1723386></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-1e970af1><div class="content-container" data-v-1e970af1><!--[--><!--]--><main class="main" data-v-1e970af1><div style="position:relative;" class="vp-doc _zh_blogs_20210409_index" data-v-1e970af1><div><nav class="table-of-contents"><ul><li><a href="#伪目标-phony-target">伪目标 Phony Target</a></li><li><a href="#预定义的变量">预定义的变量</a></li><li><a href="#默认cc">默认CC</a></li><li><a href="#内存泄漏检测">内存泄漏检测</a></li><li><a href="#代码覆盖率">代码覆盖率</a></li><li><a href="#为目录下所有文件生成目标代码">为目录下所有文件生成目标代码</a></li><li><a href="#特殊符号">特殊符号</a></li><li><a href="#赋值符号">赋值符号</a></li><li><a href="#递归编译多目录">递归编译多目录</a></li><li><a href="#编译时添加宏定义">编译时添加宏定义</a></li><li><a href="#杂项">杂项</a></li><li><a href="#指定安装目录">指定安装目录</a></li><li><a href="#多级目录、多个链接库">多级目录、多个链接库</a></li></ul></nav><h1 id="makefile-笔记" tabindex="-1">Makefile 笔记 <a class="header-anchor" href="#makefile-笔记" aria-hidden="true">#</a></h1><p>记录一些遇到的问题</p><h2 id="伪目标-phony-target" tabindex="-1">伪目标 Phony Target <a class="header-anchor" href="#伪目标-phony-target" aria-hidden="true">#</a></h2><p>当目录下路径或文件与 Makefile中 的目标名冲突的时候，可以通过定义伪目标的方式避免冲突：</p><p>如下面这个例子</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">touch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clean</span></span>
<span class="line"><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clean</span></span>
<span class="line"></span></code></pre></div><p>这样不会执行 Makefile 中定义的 clean 目标，而是会提示我们 <code>clean is up to date</code></p><p>此时需要使用 <code>.PHONY</code> 关键字来定义 clean</p><p>在 Makefile 中需要写</p><div class="language-makefile"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#82AAFF;">.PHONY</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> clean</span></span>
<span class="line"></span></code></pre></div><h2 id="预定义的变量" tabindex="-1">预定义的变量 <a class="header-anchor" href="#预定义的变量" aria-hidden="true">#</a></h2><table><thead><tr><th>预定义变量</th><th>含义</th></tr></thead><tbody><tr><td>AR</td><td>库文件维护程序的名称，默认值为ar</td></tr><tr><td>AS</td><td>汇编程序的名称，默认值为as</td></tr><tr><td>CC</td><td>C 编译器的名称，默认值为cc</td></tr><tr><td>CPP</td><td>C 预编译器的名称，默认值为$(CC) –E</td></tr><tr><td>CXX</td><td>C++编译器的名称，默认值为g++</td></tr><tr><td>FC</td><td>FORTARAN 编译器的名称，默认值为f77</td></tr><tr><td>RM</td><td>文件删除程序的名称，默认值为rm -f</td></tr><tr><td>ARFLAGS</td><td>库文件维护程序的选项，无默认值</td></tr><tr><td>ASFLAGS</td><td>汇编程序的选项，无默认值</td></tr><tr><td>CFLAGS</td><td>C 编译器的选项，无默认值</td></tr><tr><td>CPPFLAGS</td><td>C 预编译的选项，无默认值</td></tr><tr><td>CXXFLAGS</td><td>C++编译器的选项，无默认值</td></tr><tr><td>FFLAGS</td><td>Fortran 编译器的选项，无默认值</td></tr></tbody></table><h2 id="默认cc" tabindex="-1">默认CC <a class="header-anchor" href="#默认cc" aria-hidden="true">#</a></h2><p>在默认情况下，编译器使用 <code>cc</code>，可以通过<code>update-alternatives --list cc</code> 命令查看安装的 C 编译器种类，然后使用 <code>update-alternatives --set cc</code> 按照提示设置。</p><h2 id="内存泄漏检测" tabindex="-1">内存泄漏检测 <a class="header-anchor" href="#内存泄漏检测" aria-hidden="true">#</a></h2><p>之前用过 valgrind 工具辅助分析。还有一个比较好用的是 sanitize，可以在编译时作为 <code>CFLAGS</code> 添加，比如使用 address 选项检测非法内存地址</p><div class="language-makefile"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">ifeq</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">ASAN</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">1) </span><span style="color:#676E95;font-style:italic;"># 需要定义该参数</span></span>
<span class="line"><span style="color:#A6ACCD;">CFLAGS </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> -fsanitize=address</span></span>
<span class="line"><span style="color:#A6ACCD;">LDFLAGS </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> -fsanitize=address</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">endif</span></span>
<span class="line"></span></code></pre></div><p><code>-fsanitize=leak</code> 则可以检查泄漏</p><h2 id="代码覆盖率" tabindex="-1">代码覆盖率 <a class="header-anchor" href="#代码覆盖率" aria-hidden="true">#</a></h2><p>gcov是在代码运行时统计代码覆盖率的工具，随着gcc一起发布的。 它的使用很简单，需要在编译和链接时增加-fprofile-arcs -ftest-coverage生成二进制文件。</p><div class="language-makefile"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">ifeq</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">COVERAGE</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">1)</span></span>
<span class="line"><span style="color:#A6ACCD;">CFLAGS </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> -fprofile-arcs -ftest-coverage</span></span>
<span class="line"><span style="color:#A6ACCD;">LDFLAGS </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> -fprofile-arcs</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">endif</span></span>
<span class="line"></span></code></pre></div><p>gcov主要使用.gcno和.gcda两个文件。 .gcno是由-ftest-coverage产生的，它包含了重建基本块图和相应的块的源码的行号的信息。 .gcda是由加了-fprofile-arcs编译参数的编译后的文件运行所产生的，它包含了弧跳变的次数和其他的概要信息。</p><h2 id="为目录下所有文件生成目标代码" tabindex="-1">为目录下所有文件生成目标代码 <a class="header-anchor" href="#为目录下所有文件生成目标代码" aria-hidden="true">#</a></h2><p>可以使用例如下面 Makefile 的写法，使用通配符</p><div class="language-makefile"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">SOURCES </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#82AAFF;">wildcard</span><span style="color:#C3E88D;"> *.c</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">OBJS </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#82AAFF;">patsubst</span><span style="color:#C3E88D;"> %.c</span><span style="color:#89DDFF;">,</span><span style="color:#C3E88D;">%.o</span><span style="color:#89DDFF;">,$(</span><span style="color:#A6ACCD;">SOURCES</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">All</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">OBJS</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="特殊符号" tabindex="-1">特殊符号 <a class="header-anchor" href="#特殊符号" aria-hidden="true">#</a></h2><p><code>$@</code> 表示目标文件</p><p><code>$^</code> 表示所有的依赖文件</p><p><code>$&lt;</code> 表示第一个依赖文件</p><p><code>$?</code> 表示比目标还要新的依赖文件列表</p><p><code>$%</code> 仅当目标是函数库文件中，表示规则中的目标成员名。例如，如果一个目标是<code>foo.a(bar.o)</code>，那么，<code>$%</code>就是<code>bar.o</code>，<code>$@</code>就是<code>foo.a</code>。如果目标不是函数库文件，那么，其值为空。</p><p><code>$+</code> 这个变量很像<code>$^</code>，也是所有依赖目标的集合。只是它不去除重复的依赖目标。</p><p><code>$*</code> 这个变量表示目标模式中 <code>% </code>及其之前的部分。如果目标是 <code>dir/a.foo.b</code>，并且目标的模式是<code>a.%.b</code>，那么，<code>$*</code>的值就是<code>dir/a.foo</code>。这个变量对于构造有关联的文件名是比较有较。如果目标中没有模式的定义，那么<code>$*</code>也就不能被推导出，但是，如果目标文件的后缀是make所识别的，那么<code>$*</code>就是除了后缀的那一部分。例如：如果目标是“foo.c”，因为“.c”是make所能识别的后缀名，所以，<code>$*</code>的值就是<code>foo</code>。这个特性是GNU make的，很有可能不兼容于其它版本的make，所以，你应该尽量避免使用<code>$*</code>，除非是在隐含规则或是静态模式中。如果目标中的后缀是make所不能识别的，那么<code>$*</code>就是空值。</p><h2 id="赋值符号" tabindex="-1">赋值符号 <a class="header-anchor" href="#赋值符号" aria-hidden="true">#</a></h2><ul><li><code>=</code> 是最基本的赋值</li><li><code>:=</code> 是覆盖之前的值</li><li><code>?=</code> 是如果没有被赋值过就赋予等号后面的值</li><li><code>+=</code> 是添加等号后面的值</li></ul><h2 id="递归编译多目录" tabindex="-1">递归编译多目录 <a class="header-anchor" href="#递归编译多目录" aria-hidden="true">#</a></h2><p>假设目标代码和可执行文件都在 <code>debug</code> 目录下，其他都是源代码文件，则根目录下 Makefile</p><div class="language-makefile"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#设置编译器</span></span>
<span class="line"><span style="color:#A6ACCD;">CC</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">gcc</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#debug文件夹里的makefile文件需要最后执行，所以这里需要执行的子目录要排除debug文件夹，这里使用awk排除了debug文件夹，读取剩下的文件夹</span></span>
<span class="line"><span style="color:#A6ACCD;">SUBDIRS</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">$(</span><span style="color:#82AAFF;">shell</span><span style="color:#C3E88D;"> ls -l | grep ^d | awk &#39;{if(</span><span style="color:#A6ACCD;">$$</span><span style="color:#C3E88D;">9 != &quot;debug&quot;) print </span><span style="color:#A6ACCD;">$$</span><span style="color:#C3E88D;">9}&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#无需下一行的注释代码，因为我们已经知道debug里的makefile是最后执行的，所以最后直接去debug目录下执行指定的makefile文件就行，具体下面有注释</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#DEBUG=$(shell ls -l | grep ^d | awk &#39;{if($$9 == &quot;debug&quot;) print $$9}&#39;)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#记住当前工程的根目录路径</span></span>
<span class="line"><span style="color:#A6ACCD;">ROOT_DIR</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">$(</span><span style="color:#82AAFF;">shell</span><span style="color:#C3E88D;"> pwd</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#最终bin文件的名字，可以更改为自己需要的</span></span>
<span class="line"><span style="color:#A6ACCD;">BIN</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">myapp</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#目标文件所在的目录</span></span>
<span class="line"><span style="color:#A6ACCD;">OBJS_DIR</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">debug/obj</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#bin文件所在的目录</span></span>
<span class="line"><span style="color:#A6ACCD;">BIN_DIR</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">debug/bin</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#获取当前目录下的c文件集，放在变量CUR_SOURCE中</span></span>
<span class="line"><span style="color:#A6ACCD;">CUR_SOURCE</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">${</span><span style="color:#82AAFF;">wildcard</span><span style="color:#C3E88D;"> *.c</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#将对应的c文件名转为o文件后放在下面的CUR_OBJS变量中</span></span>
<span class="line"><span style="color:#A6ACCD;">CUR_OBJS</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">${</span><span style="color:#82AAFF;">patsubst</span><span style="color:#C3E88D;"> %.c</span><span style="color:#89DDFF;">,</span><span style="color:#C3E88D;"> %.o</span><span style="color:#89DDFF;">,</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">CUR_SOURCE</span><span style="color:#89DDFF;">)}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#将以下变量导出到子shell中，本次相当于导出到子目录下的makefile中</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> CC BIN OBJS_DIR BIN_DIR ROOT_DIR</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#注意这里的顺序，需要先执行SUBDIRS最后才能是DEBUG</span></span>
<span class="line"><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">SUBDIRS</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">CUR_OBJS</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> DEBUG</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#递归执行子目录下的makefile文件，这是递归执行的关键</span></span>
<span class="line"><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">SUBDIRS</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:ECHO</span></span>
<span class="line"><span style="color:#A6ACCD;">    make -C $@</span></span>
<span class="line"><span style="color:#82AAFF;">DEBUG</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">ECHO</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">#直接去debug目录下执行makefile文件</span></span>
<span class="line"><span style="color:#A6ACCD;">    make -C debug</span></span>
<span class="line"><span style="color:#82AAFF;">ECHO</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    @echo </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">SUBDIRS</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#将c文件编译为o文件，并放在指定放置目标文件的目录中即OBJS_DIR</span></span>
<span class="line"><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">CUR_OBJS</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:%.o:%.c</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">CC</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> -c $^ -o </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">ROOT_DIR</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">OBJS_DIR</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/$@</span></span>
<span class="line"><span style="color:#82AAFF;">CLEAN</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    @rm </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">OBJS_DIR</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/*.o</span></span>
<span class="line"><span style="color:#A6ACCD;">    @rm -rf </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">BIN_DIR</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/*</span></span>
<span class="line"></span></code></pre></div><p>子目录 makefile</p><div class="language-makefile"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#子目录的Makefile直接读取其子目录就行，使用 grep 过滤出来目录（ls 后会以d为标识开头）</span></span>
<span class="line"><span style="color:#A6ACCD;">SUBDIRS</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">$(</span><span style="color:#82AAFF;">shell</span><span style="color:#C3E88D;"> ls -l | grep ^d | awk &#39;{print </span><span style="color:#A6ACCD;">$$</span><span style="color:#C3E88D;">9}&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#以下同根目录下的makefile的相同代码的解释</span></span>
<span class="line"><span style="color:#A6ACCD;">CUR_SOURCE</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">${</span><span style="color:#82AAFF;">wildcard</span><span style="color:#C3E88D;"> *.c</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">CUR_OBJS</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">${</span><span style="color:#82AAFF;">patsubst</span><span style="color:#C3E88D;"> %.c</span><span style="color:#89DDFF;">,</span><span style="color:#C3E88D;"> %.o</span><span style="color:#89DDFF;">,</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">CUR_SOURCE</span><span style="color:#89DDFF;">)}</span></span>
<span class="line"><span style="color:#82AAFF;">ALL</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">SUBDIRS</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">CUR_OBJS</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">SUBDIRS</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:ECHO</span></span>
<span class="line"><span style="color:#A6ACCD;">    make -C $@</span></span>
<span class="line"><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">CUR_OBJS</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:%.o:%.c</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">CC</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> -c $^ -o </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">ROOT_DIR</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">OBJS_DIR</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/$@</span></span>
<span class="line"><span style="color:#82AAFF;">ECHO</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    @echo </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">SUBDIRS</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>生成的目标文件和可执行文件目录<code>debug</code>下 makefile</p><div class="language-makefile"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">OBJS</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">*.o</span></span>
<span class="line"><span style="color:#A6ACCD;">ODIR</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">obj</span></span>
<span class="line"><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">ROOT_DIR</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">BIN_DIR</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">BIN</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">ODIR</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">OBJS</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">CC</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> -o $@ $^</span></span>
<span class="line"></span></code></pre></div><h2 id="编译时添加宏定义" tabindex="-1">编译时添加宏定义 <a class="header-anchor" href="#编译时添加宏定义" aria-hidden="true">#</a></h2><p>假设代码如下，检查是否存在</p><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// test.c</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdio.h</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdlib.h</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">argc</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">char</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">argv</span><span style="color:#C792EA;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">      </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#ifndef</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">A_MACRO</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#endif</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>命令行直接使用 gcc 编译时，可以传递 <code>-D</code> 参数来定义</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">gcc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test.c</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">A_MACRO</span></span>
<span class="line"></span></code></pre></div><p>在 Makefile 中，当然可以在 gcc 后面写 -D，也可以直接加在 <code>CFLAGS</code> 中，同时也可以用下面的方式给 make 传递参数决定是否定义该宏</p><div class="language-makefile"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">MACROS</span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#A6ACCD;">CFLAGS</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">-g </span><span style="color:#89DDFF;">$(</span><span style="color:#A6ACCD;">MACROS</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">a.out</span></span>
<span class="line"><span style="color:#A6ACCD;">g++ CFLAGS -o a.out</span></span>
<span class="line"></span></code></pre></div><p>使用 make 时，便可以这样写</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DEBUG=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-D A_MACRO</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><h2 id="杂项" tabindex="-1">杂项 <a class="header-anchor" href="#杂项" aria-hidden="true">#</a></h2><ul><li><p>当没有指明目标时，make 默认执行 Makefile 中定义的第一个目标，也称为默认目标</p></li><li><p>在 Makefile 中，使用 <code>@echo</code> 可以执行 <code>echo</code> 命令</p></li><li><p>在 Makefile 中，目标后可以添加其他目标，表示依赖关系，即当前目标需要这些目标作为支持，会先构建依赖着的其他目标，再执行剩下的命令，即基本语法是</p><div class="language-makefile"><button title="Copy Code" class="copy"></button><span class="lang">makefile</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#82AAFF;">target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> prerequisites</span></span>
<span class="line"><span style="color:#A6ACCD;">	command</span></span>
<span class="line"></span></code></pre></div></li><li><p>直接使用 <code>=</code> 就可以在 Makefile 中定义变量如 <code>CC = gcc</code>，使用 <code>$(CC)</code> 可以读取它</p></li></ul><h1 id="cmake-笔记" tabindex="-1">cmake 笔记 <a class="header-anchor" href="#cmake-笔记" aria-hidden="true">#</a></h1><p>使用 cmake 读取 CMakeList.txt 可以自动生成需要的 Makefile。CMakeList 的语法：</p><h2 id="指定安装目录" tabindex="-1">指定安装目录 <a class="header-anchor" href="#指定安装目录" aria-hidden="true">#</a></h2><p>通过定义 <code>CMAKE_INSTALL_PREFIX:PATH</code> 更改安装路径，在无法获取 sudo 权限时候可以使用这种方式安到当前用户目录下？</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"><span style="color:#FFCB6B;">cmake</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-DCMAKE_INSTALL_PREFIX:PATH=</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">realpath</span><span style="color:#C3E88D;"> ../install</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">..</span></span>
<span class="line"><span style="color:#FFCB6B;">make</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-j</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">N</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"></span></code></pre></div><p>例如这个例子中，通过 <code>realpath</code> 获取相对路径的绝对路径名，从而安装在上级的 install 目录下</p><h2 id="多级目录、多个链接库" tabindex="-1">多级目录、多个链接库 <a class="header-anchor" href="#多级目录、多个链接库" aria-hidden="true">#</a></h2><p>例如这里我有一个</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#82AAFF;">.</span></span>
<span class="line"><span style="color:#FFCB6B;">├──</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">main.c</span></span>
<span class="line"><span style="color:#FFCB6B;">├──</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">first.c</span></span>
<span class="line"><span style="color:#FFCB6B;">├──</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">first.h</span></span>
<span class="line"><span style="color:#FFCB6B;">└──</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">second</span></span>
<span class="line"></span></code></pre></div><p>这样的文件目录，怎么在根目录下构建 <code>main.c</code> 呢？同时依赖于 <code>first.c</code> 文件和 <code>second</code> 目录下的两个库（均为 C 实现），同时 <code>first.c</code> 又依赖于 <code>second</code>目录下的库。</p><p>在根目录下，编写</p><div class="language-cmake"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">cmake_minimum_required</span><span style="color:#A6ACCD;"> (VERSION 3.10.2)</span></span>
<span class="line"><span style="color:#89DDFF;">project</span><span style="color:#A6ACCD;"> (laser)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">set</span><span style="color:#A6ACCD;">(CMAKE_C_FLAGS </span><span style="color:#C3E88D;">&quot;${CMAKE_C_FLAGS} -Wall&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">add_definitions</span><span style="color:#A6ACCD;">(-DENABLE_DBG)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># second lib</span></span>
<span class="line"><span style="color:#89DDFF;">add_subdirectory</span><span style="color:#A6ACCD;">(second) </span><span style="color:#676E95;font-style:italic;"># add this directory to project, traverse it, and apply the `CMakeLists.txt` inside it</span></span>
<span class="line"><span style="color:#89DDFF;">list</span><span style="color:#A6ACCD;">(APPEND EXTRA_INCLUDES </span><span style="color:#C3E88D;">&quot;${PROJECT_SOURCE_DIR}/second&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">set_target_properties</span><span style="color:#A6ACCD;">(second PROPERTIES LINKER_LANGUAGE C)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># lib for first main logic</span></span>
<span class="line"><span style="color:#89DDFF;">add_library</span><span style="color:#A6ACCD;">(first first.c)</span></span>
<span class="line"><span style="color:#89DDFF;">target_link_libraries</span><span style="color:#A6ACCD;">(first second) </span><span style="color:#676E95;font-style:italic;"># built target for `first` lib would be dependent on on second lib</span></span>
<span class="line"><span style="color:#89DDFF;">target_include_directories</span><span style="color:#A6ACCD;">(first PUBLIC</span></span>
<span class="line"><span style="color:#A6ACCD;">  ${PROJECT_BINARY_DIR}</span></span>
<span class="line"><span style="color:#A6ACCD;">  ${EXTRA_INCLUDES}</span></span>
<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#676E95;font-style:italic;"># the headers in the second lib would be added to include path, so that we do not need to configure relative paths when include them in codes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># main executable file</span></span>
<span class="line"><span style="color:#89DDFF;">set</span><span style="color:#A6ACCD;">(SRC_LIST main.c)</span></span>
<span class="line"><span style="color:#89DDFF;">add_executable</span><span style="color:#A6ACCD;">(laser ${SRC_LIST})</span></span>
<span class="line"><span style="color:#89DDFF;">target_link_libraries</span><span style="color:#A6ACCD;">(laser first)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># or target_link_libraries(laser first second), up to your requirements on second lib</span></span>
<span class="line"></span></code></pre></div><p>对 first 和 second 两个库和 main.c 对应的代码都构建编译 target，通过 <code>target_link_libraries</code> 去声明依赖关系，这样会自动先编译 second 库，再编译 first 库，把 second 库链接给它，再链接 first 库编译 main.c 对应的可执行文件。使用 cmake 就是一个声明依赖关系的过程，而且很多步骤 cmake 都会自动帮忙干。</p><p>那么在 second 目录下，还需要加一个，定义一个名为 second 的库，并用 <code>file()</code> 函数方便地选取目录下所有文件</p><div class="language-cmake"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">file</span><span style="color:#A6ACCD;">(GLOB SOURCES *.c)</span></span>
<span class="line"><span style="color:#89DDFF;">file</span><span style="color:#A6ACCD;">(GLOB HEADERS *.h)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">add_library</span><span style="color:#A6ACCD;">(second ${SOURCES} ${HEADERS})</span></span>
<span class="line"></span></code></pre></div><h1 id="reference" tabindex="-1">Reference <a class="header-anchor" href="#reference" aria-hidden="true">#</a></h1><p><a href="http://www.gnu.org/software/make/" target="_blank" rel="noreferrer">Make - GNU Project - Free Software Foundation</a></p><p><a href="https://github.com/seisman/how-to-write-makefile" target="_blank" rel="noreferrer">seisman/how-to-write-makefile: 跟我一起写Makefile重制版 (github.com)</a></p><p><a href="https://blog.csdn.net/u014470361/article/details/103447678" target="_blank" rel="noreferrer">gcc编译选项-fprofile-arcs -ftest-coverage之代码覆盖率_夜风的博客-CSDN博客</a></p><p><a href="https://www.cnblogs.com/Shirlies/p/4282182.html" target="_blank" rel="noreferrer">多文件目录下makefile文件递归执行编译所有c文件 - Shirlies - 博客园 (cnblogs.com)</a></p></div></div></main><!--[--><!--]--><!----><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div><!----><footer data-v-4f0db67d> Powered by <a href="https://github.com/forsworns/" target="_blank" title="Author" data-v-4f0db67d>Peihao Yang</a> | Copyright © 2019-2024 | MIT License </footer><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"b0acd32e\",\"zh_about-me_index.md\":\"54b4c163\",\"zh_blogs_20190919_index.md\":\"bf11636e\",\"zh_blogs_20190721_index.md\":\"bc724d53\",\"zh_blogs_20190824_index.md\":\"028b7618\",\"zh_blogs_20190901_index.md\":\"3037bb07\",\"about-me_index.md\":\"f9b7d43b\",\"zh_blogs_20190908_index.md\":\"ec21af58\",\"zh_blogs_20200816_index.md\":\"97225b25\",\"zh_blogs_20201023_index.md\":\"74cb3041\",\"zh_blogs_20191112_index.md\":\"9cedd743\",\"zh_blogs_20200817_index.md\":\"a4465ca0\",\"zh_blogs_20200616_index.md\":\"6d800b84\",\"zh_blogs_20210120_index.md\":\"c0d145c5\",\"zh_blogs_20210223_index.md\":\"fe476edb\",\"zh_blogs_20210204_index.md\":\"039f39d7\",\"zh_blogs_20210203_index.md\":\"31cf9244\",\"zh_blogs_20200818_index.md\":\"6fd64e68\",\"zh_blogs_20191102_index.md\":\"b0000e5a\",\"zh_blogs_20210123_index.md\":\"aecbe62d\",\"zh_blogs_20191109_index.md\":\"bc6b177e\",\"zh_blogs_20210224_index.md\":\"d04ee978\",\"zh_blogs_20210226_index.md\":\"57455fcf\",\"zh_blogs_20210310_index.md\":\"6c158c4c\",\"zh_blogs_20191103_index.md\":\"aaa9b685\",\"zh_blogs_20210311_index.md\":\"c94bce11\",\"zh_blogs_20210315_index.md\":\"b2dc2fa3\",\"zh_blogs_20210312_index.md\":\"cf9cedd6\",\"zh_blogs_20210506_index.md\":\"c199e216\",\"zh_blogs_20210409_index.md\":\"26b10045\",\"zh_blogs_20210430_index.md\":\"16608a50\",\"zh_blogs_20210412_index.md\":\"4d500176\",\"zh_blogs_20210329_index.md\":\"856db954\",\"zh_blogs_20210715_index.md\":\"1574396a\",\"zh_blogs_20211130_index.md\":\"e8a8380a\",\"zh_index.md\":\"f853cd4d\",\"zh_blogs_20240526_index.md\":\"79109fc2\",\"zh_blogs_20240519_index.md\":\"881fe7ad\",\"zh_blogs_tags_index.md\":\"df0b83e5\",\"zh_blogs_20240518_index.md\":\"f307d047\",\"zh_blogs_20240513_index.md\":\"ef1578d3\",\"zh_blogs_20221024_index.md\":\"650d1fa3\",\"zh_blogs_20240413_index.md\":\"47c37f6a\",\"zh_blogs_20230125_index.md\":\"fac91776\",\"zh_blogs_20240427_index.md\":\"eb633e02\",\"zh_blogs_20230201_index.md\":\"94bee658\",\"zh_blogs_20230209_index.md\":\"8ec3d31e\",\"zh_blogs_20230322_index.md\":\"034d2208\",\"zh_blogs_20240128_index.md\":\"f7c327b2\",\"zh_blogs_20230201_repost.md\":\"a6decb43\",\"zh_blogs_20240215_index.md\":\"494196e2\",\"zh_blogs_20230601_index.md\":\"6888a6a4\",\"zh_blogs_20240220_index.md\":\"71a07ba2\",\"zh_blogs_20230101_index.md\":\"b90c3fa8\",\"zh_blogs_20221108_index.md\":\"6a3009dc\",\"zh_blogs_20220611_index.md\":\"6f724322\",\"zh_blogs_20220316_index.md\":\"1e30f14e\",\"zh_blogs_20211120_index.md\":\"0ce82d52\",\"zh_blogs_20210728_index.md\":\"f201636f\",\"zh_blogs_20211002_index.md\":\"1e08cca2\",\"zh_blogs_20220224_index.md\":\"d5e28068\",\"zh_blogs_20220105_index.md\":\"4414a80c\",\"zh_blogs_20211210_index.md\":\"04871e1a\",\"zh_blogs_20210706_index.md\":\"462304ea\",\"zh_blogs_20210822_index.md\":\"bb964204\",\"zh_blogs_20220101_index.md\":\"3878bee5\",\"zh_blogs_20230126_index.md\":\"481431f2\",\"zh_blogs_20230121_index.md\":\"180ff2ef\",\"zh_blogs_20210627_index.md\":\"5b7bfe9a\",\"zh_blogs_index.md\":\"9cc4ae4a\",\"zh_blogs_20221228_index.md\":\"55f76496\",\"zh_blogs_20240423_index.md\":\"30366273\",\"zh_blogs_20240620_index.md\":\"d596ede2\",\"zh_blogs_20210801_index.md\":\"ebf8f3ff\"}")</script>
    <script type="module" async src="/assets/app.6da136a8.js"></script>
    
  </body>
</html>