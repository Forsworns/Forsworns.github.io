<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sentinel Rust ä»‹ç» | Sharlayan</title>
    <meta name="description" content="Sentinel-Rust ä»‹ç»å’Œç¤ºä¾‹">
    <link rel="preload stylesheet" href="/assets/style.3ef9b918.css" as="style">
    <link rel="modulepreload" href="/assets/chunks/VPAlgoliaSearchBox.67faf014.js">
    <link rel="modulepreload" href="/assets/app.0404ad13.js">
    <link rel="modulepreload" href="/assets/zh_blogs_20211120_index.md.4e4f89ba.lean.js">
    
    <script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.staticfile.org/ionicons/2.0.1/css/ionicons.min.css">
  <link rel="icon" type="image/png" href="/logo.png">
  <meta name="author" content="Peihao Yang">
  <meta property="og:title" content="Home">
  <meta property="og:description" content="Home of Peihao Yang">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><!--[--><div class="Layout" data-v-b617430f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-d4120332></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-d4120332> Skip to content </a><!--]--><!----><header class="VPNav no-sidebar" data-v-b617430f data-v-aa1cde23><div class="VPNavBar" data-v-aa1cde23 data-v-cbdd8588><div class="container" data-v-cbdd8588><div class="title" data-v-cbdd8588><div class="VPNavBarTitle" data-v-cbdd8588 data-v-730d6dd1><a class="title" href="/zh/" data-v-730d6dd1><!--[--><!--]--><!--[--><img class="VPImage logo" src="/assets/logo.png" alt data-v-0f13a436><!--]--><!----><!--[--><!--]--></a></div></div><div class="content" data-v-cbdd8588><div class="curtain" data-v-cbdd8588></div><!--[--><!--]--><div class="VPNavBarSearch search" data-v-cbdd8588 style="--699c4559:&#39;Meta&#39;;"><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-cbdd8588 data-v-2d3a777e><span id="main-nav-aria-label" class="visually-hidden" data-v-2d3a777e>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh/" data-v-2d3a777e data-v-f559a019 data-v-1a0f9836><!--[-->ğŸ¡ä¸»é¡µ<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh/about-me/" data-v-2d3a777e data-v-f559a019 data-v-1a0f9836><!--[-->ğŸ¦¹â€â™‚ï¸å…³äºæˆ‘<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-2d3a777e data-v-fc33d832><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-fc33d832><span class="text" data-v-fc33d832><!----> ğŸ““åšå®¢ <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-fc33d832><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-fc33d832><div class="VPMenu" data-v-fc33d832 data-v-ecf4e7d9><div class="items" data-v-ecf4e7d9><!--[--><!--[--><div class="VPMenuLink" data-v-ecf4e7d9 data-v-c7da634f><a class="VPLink link" href="/zh/blogs/" data-v-c7da634f data-v-1a0f9836><!--[-->ğŸ“ƒæ‰€æœ‰åšå®¢<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-ecf4e7d9 data-v-c7da634f><a class="VPLink link" href="/zh/blogs/tags/" data-v-c7da634f data-v-1a0f9836><!--[-->ğŸ”–æ ‡ç­¾åˆ†ç±»<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://forsworns.github.io/feed.xml" target="_blank" rel="noreferrer" data-v-2d3a777e data-v-f559a019 data-v-1a0f9836><!--[-->ğŸ”¥RSS<!--]--><!----></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-cbdd8588 data-v-7cdc304e data-v-fc33d832><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-fc33d832><span class="text" data-v-fc33d832><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="option-icon" data-v-fc33d832><path d="M0 0h24v24H0z" fill="none"></path><path d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z " class="css-c4d79v"></path></svg>  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-fc33d832><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-fc33d832><div class="VPMenu" data-v-fc33d832 data-v-ecf4e7d9><!----><!--[--><!--[--><div class="items" data-v-7cdc304e><p class="title" data-v-7cdc304e>ä¸­æ–‡</p><!--[--><div class="VPMenuLink" data-v-7cdc304e data-v-c7da634f><a class="VPLink link" href="/" data-v-c7da634f data-v-1a0f9836><!--[-->English<!--]--><!----></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-cbdd8588 data-v-7f24c201><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-7f24c201 data-v-2b897f09 data-v-ab7cdc04><span class="check" data-v-ab7cdc04><span class="icon" data-v-ab7cdc04><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-2b897f09><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-2b897f09><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-cbdd8588 data-v-a5afa74d data-v-80c99471><!--[--><a class="VPSocialLink" href="https://github.com/forsworns/blog-vitepress" target="_blank" rel="noopener" data-v-80c99471 data-v-51b6609b><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="mailto:peihao.young@gmail.com" target="_blank" rel="noopener" data-v-80c99471 data-v-51b6609b><svg role="img" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20">
            <path d="M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z" ></path>
            </svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-cbdd8588 data-v-e459e5dc data-v-fc33d832><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-fc33d832><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-fc33d832><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-fc33d832><div class="VPMenu" data-v-fc33d832 data-v-ecf4e7d9><!----><!--[--><!--[--><div class="group" data-v-e459e5dc><p class="trans-title" data-v-e459e5dc>ä¸­æ–‡</p><!--[--><div class="VPMenuLink" data-v-e459e5dc data-v-c7da634f><a class="VPLink link" href="/" data-v-c7da634f data-v-1a0f9836><!--[-->English<!--]--><!----></a></div><!--]--></div><div class="group" data-v-e459e5dc><div class="item appearance" data-v-e459e5dc><p class="label" data-v-e459e5dc>Appearance</p><div class="appearance-action" data-v-e459e5dc><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e459e5dc data-v-2b897f09 data-v-ab7cdc04><span class="check" data-v-ab7cdc04><span class="icon" data-v-ab7cdc04><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-2b897f09><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-2b897f09><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e459e5dc><div class="item social-links" data-v-e459e5dc><div class="VPSocialLinks social-links-list" data-v-e459e5dc data-v-80c99471><!--[--><a class="VPSocialLink" href="https://github.com/forsworns/blog-vitepress" target="_blank" rel="noopener" data-v-80c99471 data-v-51b6609b><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="mailto:peihao.young@gmail.com" target="_blank" rel="noopener" data-v-80c99471 data-v-51b6609b><svg role="img" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20">
            <path d="M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l266.090667 225.6a149.333333 149.333333 0 0 0 193.152 0L874.666667 375.189333zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z" ></path>
            </svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-cbdd8588 data-v-d6834c14><span class="container" data-v-d6834c14><span class="top" data-v-d6834c14></span><span class="middle" data-v-d6834c14></span><span class="bottom" data-v-d6834c14></span></span></button></div></div></div><!----></header><!----><!----><div class="VPContent" id="VPContent" data-v-b617430f data-v-f32377af><div class="VPDoc has-aside" data-v-f32377af data-v-1e970af1><div class="container" data-v-1e970af1><div class="aside" data-v-1e970af1><div class="aside-curtain" data-v-1e970af1></div><div class="aside-container" data-v-1e970af1><div class="aside-content" data-v-1e970af1><div class="VPDocAside" data-v-1e970af1 data-v-b1723386><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-b1723386 data-v-0980ba1d><div class="content" data-v-0980ba1d><div class="outline-marker" data-v-0980ba1d></div><div class="outline-title" data-v-0980ba1d>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-0980ba1d><span class="visually-hidden" id="doc-outline-aria-label" data-v-0980ba1d> Table of Contents for current page </span><ul class="root" data-v-0980ba1d data-v-6f4caaf4><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-b1723386></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-1e970af1><div class="content-container" data-v-1e970af1><!--[--><!--]--><main class="main" data-v-1e970af1><div style="position:relative;" class="vp-doc _zh_blogs_20211120_index" data-v-1e970af1><div><nav class="table-of-contents"><ul><li><a href="#sentinel-ä»‹ç»">Sentinel ä»‹ç»</a></li><li><a href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a><ul><li><a href="#é€šç”¨é…ç½®åŠåˆå§‹åŒ–">é€šç”¨é…ç½®åŠåˆå§‹åŒ–</a></li><li><a href="#åŸ‹ç‚¹-å®šä¹‰èµ„æº">åŸ‹ç‚¹(å®šä¹‰èµ„æº)</a></li><li><a href="#è§„åˆ™é…ç½®">è§„åˆ™é…ç½®</a></li><li><a href="#æµé‡æ§åˆ¶ç¤ºä¾‹">æµé‡æ§åˆ¶ç¤ºä¾‹</a></li><li><a href="#prometheus-ç›‘æ§">Prometheus ç›‘æ§</a></li><li><a href="#k8s-åŠ¨æ€æ·»åŠ æµæ§è§„åˆ™">K8S åŠ¨æ€æ·»åŠ æµæ§è§„åˆ™</a></li><li><a href="#æ›´å¤šç¤ºä¾‹">æ›´å¤šç¤ºä¾‹</a></li></ul></li><li><a href="#sentinel-rust-ç›¸å…³èµ„æº">Sentinel-Rust ç›¸å…³èµ„æº</a></li></ul></nav><h1 id="sentinel-rust-çš„ä½¿ç”¨" tabindex="-1">Sentinel Rust çš„ä½¿ç”¨ <a class="header-anchor" href="#sentinel-rust-çš„ä½¿ç”¨" aria-hidden="true">#</a></h1><p>Sentinel æ˜¯ä¸€ä¸ªé¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„æµé‡æ§åˆ¶ç»„ä»¶ï¼Œå®ƒå¯ä»¥æå‡æœåŠ¡çš„ç¨³å®šæ€§ã€‚åœ¨ Sentinel ä¸­ï¼Œåº”ç”¨ç¨‹åºæä¾›çš„æœåŠ¡æˆ–å…¶è°ƒç”¨çš„ç›¸å…³æœåŠ¡å‡å¯è¢«è§†ä¸ºèµ„æºï¼Œå—åˆ° Sentinel çš„ä¿æŠ¤ã€‚å›´ç»•è¿™äº›èµ„æºçš„å®æ—¶çŠ¶æ€ï¼Œå¯ä»¥æµé‡æ§åˆ¶è§„åˆ™ã€ç†”æ–­é™çº§è§„åˆ™ä»¥åŠç³»ç»Ÿä¿æŠ¤è§„åˆ™æ¥é¿å…è¯·æ±‚å¤§é‡å †ç§¯é€ æˆçš„ç³»ç»Ÿç˜«ç—ªã€‚Sentinel å¯ä»¥è¢«å¹¿æ³›åœ°åº”ç”¨åœ¨å„ç§åº”ç”¨åœºæ™¯ä¸‹ï¼Œä¸äº‘åŸç”Ÿä¹Ÿæœ‰ç€ç´§å¯†çš„ç»“åˆã€‚</p><!----><!----><p>Sentinel æœ‰ç€å¤šå¹´çš„å‘å±•å†å²ï¼Œæœ€åˆä¸“æ³¨äºå…¥å£æµé‡æ§åˆ¶ï¼Œç»è¿‡å¤šå¹´æ‰“ç£¨åå¼€æºï¼Œå¹¶é€æ­¥æä¾›å¤šè¯­è¨€åŸç”Ÿæ”¯æŒã€‚</p><!----><!----><p>æœ¬é¡¹ç›®å‚è€ƒå·²æœ‰çš„ Java ä¸ Golang ç‰ˆæœ¬ï¼Œé‡‡ç”¨ Rust å¼€å‘ Sentinel çš„åŸç”Ÿç‰ˆæœ¬ï¼Œä½¿ç”¨ Rust Attribute Macro æä¾›ä½ä¾µå…¥å¼çš„è§„åˆ™å®šä¹‰æ–¹æ³•ï¼Œæ”¯æŒä½¿ç”¨ Prometheus è¿›è¡Œå¯è§†åŒ–ç›‘æ§ï¼Œæ”¯æŒä½¿ç”¨ etcdã€Consul ç­‰åŠ¨æ€åŠ è½½è§„åˆ™ã€‚</p><!----><!----><p>é¡¹ç›®æ‰˜ç®¡äº GitHubï¼Œé“¾æ¥ï¼š<a href="https://github.com/sentinel-group/sentinel-rust" target="_blank" rel="noreferrer">Sentinel-Rust</a>ã€‚åœ¨é¡¹ç›® <a href="https://github.com/sentinel-group/sentinel-rust/wiki/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97" target="_blank" rel="noreferrer">WiKi</a> ä¸­æä¾›äº†è¯¦ç»†çš„æ–‡æ¡£ï¼ŒåŒæ—¶æä¾›äº†å¤§é‡çš„<a href="https://github.com/sentinel-group/sentinel-rust/tree/main/examples" target="_blank" rel="noreferrer">ç¤ºä¾‹ç¨‹åº</a>ä¾›å‚è€ƒã€‚å¦å¤–ï¼Œå¯ä»¥åœ¨æœ¬åœ°è¿è¡Œ <code>cargo doc</code> ç”Ÿæˆ API æ–‡æ¡£ã€‚</p><h2 id="sentinel-ä»‹ç»" tabindex="-1">Sentinel ä»‹ç» <a class="header-anchor" href="#sentinel-ä»‹ç»" aria-hidden="true">#</a></h2><p>Sentinel Rust çš„è®¾è®¡é‡‡ç”¨äº†<a href="https://refactoringguru.cn/design-patterns/chain-of-responsibility" target="_blank" rel="noreferrer">è´£ä»»é“¾</a>çš„æ¨¡å¼ï¼Œç”¨æˆ·æŒ‡å®šçš„å„ç±»è§„åˆ™ä¼šè‡ªåŠ¨é€šè¿‡ <code>base::SlotChain</code> ä¸Šçš„æ’æ§½ (Slot) è¿›è¡Œæ£€æµ‹ã€‚ç”¨æˆ·ä½¿ç”¨ Sentinel Rust (åæ–‡å‡ç”¨ Sentinel è¡¨ç¤º Sentinel Rust) ï¼Œä¸»è¦éœ€è¦ä»¥ä¸‹å‡ æ­¥ï¼š</p><ol><li>åœ¨é¡¹ç›®é…ç½®ä¸­æ·»åŠ ä¾èµ–ï¼Œå¯¹ Sentinel çš„è¿è¡Œç¯å¢ƒè¿›è¡Œç›¸å…³é…ç½®å¹¶åˆå§‹åŒ–ã€‚</li><li>åŸ‹ç‚¹ï¼ˆå®šä¹‰èµ„æºï¼‰ï¼Œç¡®å®šç³»ç»Ÿä¸­æœ‰å“ªäº›èµ„æºéœ€è¦é˜²æŠ¤ã€‚</li><li>é…ç½®è§„åˆ™ï¼Œä¸ºæ¯ä¸ªèµ„æºé…ç½®å…·ä½“çš„è§„åˆ™ï¼Œè§„åˆ™çš„é…ç½®æ–¹æ³•å¯å‚è€ƒå„ä¸ªæ¨¡å—çš„ä½¿ç”¨æ–‡æ¡£ã€‚</li><li>ç¼–å†™èµ„æºé˜²æŠ¤çš„å…¥å£å’Œå‡ºå£ä»£ç ã€‚</li></ol><!----><!----><h2 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1">ä½¿ç”¨ç¤ºä¾‹ <a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹" aria-hidden="true">#</a></h2><p>é¦–å…ˆéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ  Sentinel ä¾èµ–ï¼Œå‘ <code>Cargo.toml</code> ä¸­æ·»åŠ </p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">dependencies</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">sentinel-rs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">path_to_sentinel</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ç”±äºç›®å‰ sentinel å°šæœªå‘å¸ƒï¼Œéœ€è¦ä¸‹è½½æºç åï¼Œæ‰‹åŠ¨è®¾ç½®è·¯å¾„ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ sentinel çš„è¿‡ç¨‹å®ç­‰å¯é€‰ç‰¹æ€§ï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/sentinel-group/sentinel-rust/wiki/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96" target="_blank" rel="noreferrer">å¯é€‰ç‰¹æ€§åˆ—è¡¨</a>ã€‚</p><h3 id="é€šç”¨é…ç½®åŠåˆå§‹åŒ–" tabindex="-1">é€šç”¨é…ç½®åŠåˆå§‹åŒ– <a class="header-anchor" href="#é€šç”¨é…ç½®åŠåˆå§‹åŒ–" aria-hidden="true">#</a></h3><p>ä½¿ç”¨ Sentinel éœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—¶å¯¹ Sentinel è¿è¡Œç¯å¢ƒè¿›è¡Œç›¸å…³é…ç½®å¹¶è§¦å‘åˆå§‹åŒ–ã€‚<code>api</code> ä¸‹æä¾›å¦‚ä¸‹å‡½æ•°ï¼š</p><ul><li><code>init_default()</code>ï¼šä»ç¯å¢ƒå˜é‡æŒ‡å®šçš„é…ç½®æ–‡ä»¶ä»¥åŠç¯å¢ƒå˜é‡ä¸­è¯»å–ç›¸åº”é…ç½®æ¥åˆå§‹åŒ– Sentinelï¼Œè‹¥ç¯å¢ƒå˜é‡ä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚</li><li><code>init_with_config_file(config_path: &amp;mut String)</code>ï¼šä»ç»™å®šçš„ YAML æ–‡ä»¶ä¸­è¯»å–ç›¸åº”é…ç½®æ¥åˆå§‹åŒ– Sentinelã€‚</li><li><code>init_with_config(config_entity: ConfigEntity)</code>: ç”¨æˆ·ç¡¬ç¼–ç é…ç½®å¯¹è±¡<code>ConfigEntity</code>æ¥åˆå§‹åŒ– Sentinelã€‚</li></ul><p>é€šç”¨é…ç½®é¡¹åŠ è½½ç­–ç•¥å’Œé…ç½®é¡¹è¯·å‚è€ƒé€šç”¨é…ç½®ç« èŠ‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">use</span><span style="color:#FFCB6B;"> sentinel_rs</span><span style="color:#89DDFF;">::{</span><span style="color:#FFCB6B;">init_default</span><span style="color:#89DDFF;">,</span><span style="color:#FFCB6B;"> logging</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#82AAFF;">init_default</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">unwrap_or_else</span><span style="color:#89DDFF;">(|</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">logging</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">error!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{</span><span style="color:#C3E88D;">:?</span><span style="color:#89DDFF;">}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> err</span><span style="color:#89DDFF;">));</span></span>
<span class="line"></span></code></pre></div><p><strong>æ³¨æ„</strong>ï¼šå¿…é¡»æˆåŠŸè°ƒç”¨ Sentinel çš„åˆå§‹åŒ–å‡½æ•°ä»¥åå†è°ƒç”¨åŸ‹ç‚¹ APIã€‚</p><h3 id="åŸ‹ç‚¹-å®šä¹‰èµ„æº" tabindex="-1">åŸ‹ç‚¹(å®šä¹‰èµ„æº) <a class="header-anchor" href="#åŸ‹ç‚¹-å®šä¹‰èµ„æº" aria-hidden="true">#</a></h3><p>ä½¿ç”¨ Sentinel çš„ Entry API å°†ä¸šåŠ¡é€»è¾‘å°è£…èµ·æ¥ï¼Œè¿™ä¸€æ­¥ç§°ä¸ºâ€œåŸ‹ç‚¹â€ã€‚æ¯ä¸ªåŸ‹ç‚¹éƒ½æœ‰ä¸€ä¸ªèµ„æºåç§°ï¼ˆresourceï¼‰ï¼Œä»£è¡¨è§¦å‘äº†è¿™ä¸ªèµ„æºçš„è°ƒç”¨æˆ–è®¿é—®ã€‚</p><p>åŸ‹ç‚¹ API ä½äº <code>api</code> ä¸­ï¼Œé€šè¿‡æ„é€  <code>EntryBuilder</code>ï¼Œè°ƒç”¨å®ƒçš„æ–¹æ³• <code>build()</code> åˆ›å»º Entryã€‚ <code>EntryBuilder</code> æä¾›äº†é“¾å¼çš„ä¼ å‚æ–¹å¼ï¼Œæœªä¼ å…¥çš„å‚æ•°å°†ä½¿ç”¨é»˜è®¤æ„é€ ã€‚</p><p>è‹¥è¯¥æ¬¡è°ƒç”¨è¢«æ‹’ç»ï¼Œåˆ™ <code>build()</code> ä¼šè¿”å› <code>Result</code> ä»£è¡¨è¢« Sentinel é™æµã€‚BlockError æä¾›äº†é™æµåŸå› ä»¥åŠè§¦å‘çš„è§„åˆ™ç­‰ä¿¡æ¯ï¼Œå¯ä»¥æ–¹ä¾¿å¼€å‘è€…è·å–ç›¸å…³ä¿¡æ¯è¿›è¡Œè®°å½•å’Œå¤„ç†ã€‚</p><h3 id="è§„åˆ™é…ç½®" tabindex="-1">è§„åˆ™é…ç½® <a class="header-anchor" href="#è§„åˆ™é…ç½®" aria-hidden="true">#</a></h3><h4 id="api-ç¡¬ç¼–ç æ–¹å¼" tabindex="-1">API ç¡¬ç¼–ç æ–¹å¼ <a class="header-anchor" href="#api-ç¡¬ç¼–ç æ–¹å¼" aria-hidden="true">#</a></h4><p>Sentinel æ”¯æŒåŸå§‹çš„ç¡¬ç¼–ç æ–¹å¼åŠ è½½è§„åˆ™ï¼Œå¯ä»¥é€šè¿‡å„ä¸ªæ¨¡å—çš„ <code>load_rules(rules)</code> æˆ– <code>append_rules(rules)</code> å‡½æ•°åŠ è½½è§„åˆ™ï¼Œå‰è€…ä¼šè¦†ç›–ä¹‹å‰çš„è§„åˆ™è®¾ç½®ï¼Œåè€…åªä¼šå‘è®¾ç½®ä¸­è¿½åŠ è§„åˆ™ã€‚ç›®å‰çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¹Ÿæ˜¯å¯¹å•ä¸€èµ„æºåŠ è½½å¤šæ¡è§„åˆ™çš„å”¯ä¸€æ‰‹æ®µã€‚ä»¥æµæ§è§„åˆ™ä¸ºä¾‹ï¼š</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">flow</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">load_rules</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">vec!</span><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">Arc</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">new</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">flow</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Rule</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    resource</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">example</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">into</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#A6ACCD;">    threshold</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    calculate_strategy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">flow</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">CalculateStrategy</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Direct</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    control_strategy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">flow</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">ControlStrategy</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Reject</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">..</span><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">default</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#89DDFF;">})]);</span></span>
<span class="line"></span></code></pre></div><h4 id="æ ‡ç­¾å®ç¡¬ç¼–ç æ–¹å¼" tabindex="-1">æ ‡ç­¾å®ç¡¬ç¼–ç æ–¹å¼ <a class="header-anchor" href="#æ ‡ç­¾å®ç¡¬ç¼–ç æ–¹å¼" aria-hidden="true">#</a></h4><p>Sentinel æä¾›äº†æ˜“ç”¨çš„æ ‡ç­¾å®ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹è§„åˆ™é…ç½®ï¼Œæˆ‘ä»¬ä¸ºä¸åŒç­–ç•¥æä¾›äº†ä¸°å¯Œçš„æ ‡ç­¾å®ä½¿ç”¨ <a href="https://github1s.com/sentinel-group/sentinel-rust/tree/main/examples/" target="_blank" rel="noreferrer">ç¤ºä¾‹</a>ï¼Œä¹Ÿå¯ä»¥é˜…è¯»åç»­æ–‡æ¡£äº†è§£ã€‚ä¸‹é¢ä»¥æµæ§è§„åˆ™ä¸ºä¾‹</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">#[</span><span style="color:#A6ACCD;">flow</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">threshold</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">10</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> calculate_strategy</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">Direct</span><span style="color:#89DDFF;">)]</span></span>
<span class="line"><span style="color:#F78C6C;">pub</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">task</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">u32</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ ‡ç­¾å®ä¼šä¿®æ”¹ <code>task</code> å‡½æ•°ç­¾åï¼Œè¿”å› <code>Result&lt;u32, String&gt;</code>ã€‚æ¥ç€ï¼Œå®ƒå°†è‡ªåŠ¨å‘è§„åˆ™åˆ—è¡¨ä¸­è¿½åŠ è§„åˆ™ï¼Œè°ƒç”¨ <code>EntryBuilder</code> åˆ›å»º Sentinel Entryï¼Œæ£€æŸ¥æŒ‡å®šçš„è§„åˆ™ã€‚å¦‚æœè¯¥ä»»åŠ¡æˆåŠŸæ‰§è¡Œï¼Œä¼šè¿”å› <code>Ok(u32)</code> ç±»å‹çš„è¿”å›å€¼ï¼›å¦åˆ™ä¼šè¿”å› <code>Err(String)</code> ç±»å‹çš„é™æµåŸå› å’Œè§¦å‘é™æµçš„å‚æ•°ã€‚</p><p>éœ€è¦æ³¨æ„ï¼Œå½“å‰çš„æ ‡ç­¾å®å®ç°ï¼Œä»…æ”¯æŒåœ¨ Resource ä¸ŠæŒ‡å®šå•ä¸€è§„åˆ™ã€‚</p><h4 id="åŠ¨æ€æ•°æ®æº" tabindex="-1">åŠ¨æ€æ•°æ®æº <a class="header-anchor" href="#åŠ¨æ€æ•°æ®æº" aria-hidden="true">#</a></h4><p>ç”± Sentinel æä¾›åŠ¨æ€æ•°æ®æºæ¥å£è¿›è¡Œæ‰©å±•ï¼Œç”¨æˆ·å¯ä»¥åŠ¨æ€åœ°é…ç½®è§„åˆ™ï¼Œå‚è€ƒä½¿ç”¨ <a href="https://github1s.com/sentinel-group/sentinel-rust/blob/main/examples/datasources/etcdv3.rs" target="_blank" rel="noreferrer">etcd</a> å’Œ <a href="https://github1s.com/sentinel-group/sentinel-rust/blob/main/examples/datasources/consul.rs" target="_blank" rel="noreferrer">Consul</a> è¿›è¡Œé…ç½®çš„ç¤ºä¾‹ã€‚</p><h3 id="æµé‡æ§åˆ¶ç¤ºä¾‹" tabindex="-1">æµé‡æ§åˆ¶ç¤ºä¾‹ <a class="header-anchor" href="#æµé‡æ§åˆ¶ç¤ºä¾‹" aria-hidden="true">#</a></h3><p>æµé‡æ§åˆ¶ (Flow Control) æ¨¡å—ï¼ŒåŸºäºä»¤ç‰Œæ¡¶ (Token Bucket) çš„æ€æƒ³ï¼Œç›‘æ§èµ„æº (Resource) çš„ç»Ÿè®¡æŒ‡æ ‡ï¼Œç„¶åæ ¹æ® Token è®¡ç®—ç­–ç•¥æ¥è®¡ç®—èµ„æºçš„å¯ç”¨ Token (ä¹Ÿå°±æ˜¯æµé‡çš„é˜ˆå€¼)ï¼Œç„¶åæ ¹æ®æµé‡æ§åˆ¶ç­–ç•¥å¯¹è¯·æ±‚è¿›è¡Œæ§åˆ¶ï¼Œé¿å…è¢«ç¬æ—¶çš„æµé‡é«˜å³°å†²å®ï¼Œä»è€Œä¿éšœåº”ç”¨çš„é«˜å¯ç”¨æ€§ã€‚</p><p>Sentinel é€šè¿‡å®šä¹‰æµæ§è§„åˆ™æ¥å®ç°å¯¹ Resource çš„æµé‡æ§åˆ¶ã€‚Sentinel å†…éƒ¨ä¼šåœ¨åŠ è½½æµæ§è§„åˆ™ï¼ˆ<code>flow::Rule</code>ï¼‰æ—¶å€™ï¼Œå°†æ¯ä¸ªè§„åˆ™è½¬æ¢æˆæµé‡æ§åˆ¶å™¨ (<code>flow::TrafficShapingController</code>)ã€‚ æ¯ä¸ªæµé‡æ§åˆ¶å™¨å®ä¾‹éƒ½ä¼šæœ‰è‡ªå·±ç‹¬ç«‹çš„ç»Ÿè®¡ç»“æ„ï¼Œè¿™é‡Œç»Ÿè®¡ç»“æ„æ˜¯ä¸€ä¸ªæ»‘åŠ¨çª—å£ã€‚Sentinel å†…éƒ¨ä¼šå°½å¯èƒ½å¤ç”¨ Resource çº§åˆ«çš„å…¨å±€æ»‘åŠ¨çª—å£ï¼Œå¦‚æœæµæ§è§„åˆ™çš„ç»Ÿè®¡è®¾ç½®æ²¡æ³•å¤ç”¨ Resource çš„å…¨å±€ç»Ÿè®¡ç»“æ„ï¼Œé‚£ä¹ˆSentinelä¼šä¸ºæµé‡æ§åˆ¶å™¨åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç§æœ‰çš„æ»‘åŠ¨çª—å£ï¼Œç„¶åé€šè¿‡ <code>flow::StandaloneStatSlot</code> è¿™ä¸ªç»Ÿè®¡ Slot æ¥ç»´æŠ¤ç»Ÿè®¡æŒ‡æ ‡ã€‚</p><p>Sentinel çš„æµé‡æ§åˆ¶ç»„ä»¶å¯¹ Resource çš„æ£€æŸ¥ç»“æœè¦ä¹ˆé€šè¿‡ï¼Œè¦ä¹ˆä¼š blockï¼Œå¯¹äº block çš„æµé‡ç›¸å½“äºæ‹’ç»ã€‚</p><p>ä¸‹é¢å±•ç¤ºä¸¤ä¸ªä¾‹å­ï¼Œç¬¬ä¸€ä¸ªä¾‹å­é€šè¿‡ API åŠ è½½æµæ§è§„åˆ™ï¼›ç¬¬äºŒä¸ªä¾‹å­é€šè¿‡æ ‡ç­¾å®è¿½åŠ è§„åˆ™ã€‚</p><h4 id="api-åŠ è½½æµæ§è§„åˆ™" tabindex="-1">API åŠ è½½æµæ§è§„åˆ™ <a class="header-anchor" href="#api-åŠ è½½æµæ§è§„åˆ™" aria-hidden="true">#</a></h4><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">use</span><span style="color:#FFCB6B;"> sentinel_rs</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">utils</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">sleep_for_ms</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">use</span><span style="color:#FFCB6B;"> sentinel_rs</span><span style="color:#89DDFF;">::{</span><span style="color:#FFCB6B;">base</span><span style="color:#89DDFF;">,</span><span style="color:#FFCB6B;"> flow</span><span style="color:#89DDFF;">,</span><span style="color:#FFCB6B;"> EntryBuilder</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F78C6C;">use</span><span style="color:#FFCB6B;"> std</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">sync</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Arc</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Init sentienl configurations</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">sentinel_rs</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">init_default</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">unwrap_or_else</span><span style="color:#89DDFF;">(|</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sentinel_rs</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">logging</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">error!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{</span><span style="color:#C3E88D;">:?</span><span style="color:#89DDFF;">}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> err</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> resource_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">direct_reject_flow_control_example</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Load sentinel rules</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">flow</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">load_rules</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">vec!</span><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">Arc</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">new</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">flow</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Rule</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        resource</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> resource_name</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#A6ACCD;">        threshold</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        calculate_strategy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">flow</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">CalculateStrategy</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Direct</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        control_strategy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">flow</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">ControlStrategy</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Reject</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">..</span><span style="color:#FFCB6B;">Default</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">default</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">})]);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">mut</span><span style="color:#A6ACCD;"> handlers </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Vec</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">new</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> _ </span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">..</span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> res_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> resource_name</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        handlers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">thread</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">spawn</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">move</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">loop</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> entry_builder </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EntryBuilder</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">new</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">res_name</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">with_traffic_type</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">base</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">TrafficType</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Inbound</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Ok</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> entry_builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">                    // Passed, wrap the logic here.</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#82AAFF;">task</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">                    // Be sure the entry is exited finally.</span></span>
<span class="line"><span style="color:#A6ACCD;">                    entry</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">borrow</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">                    // Blocked. We could get the block reason from the BlockError.</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#82AAFF;">sleep_for_ms</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">rand</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">random</span><span style="color:#89DDFF;">::&lt;</span><span style="color:#FFCB6B;">u64</span><span style="color:#89DDFF;">&gt;()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> h </span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> handlers </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        h</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">expect</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Couldn&#39;t join on the associated thread</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">task</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}</span><span style="color:#C3E88D;">: passed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sentinel_rs</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">utils</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">curr_time_millis</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">sleep_for_ms</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>æ‰§è¡Œ <code>cargo run --example hello_world</code>ï¼ŒQPS ä¼šè¢«é™åˆ¶åœ¨ 10ã€‚</p><h4 id="æ ‡ç­¾å®è¿½åŠ æµæ§è§„åˆ™" tabindex="-1">æ ‡ç­¾å®è¿½åŠ æµæ§è§„åˆ™ <a class="header-anchor" href="#æ ‡ç­¾å®è¿½åŠ æµæ§è§„åˆ™" aria-hidden="true">#</a></h4><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">use</span><span style="color:#FFCB6B;"> sentinel_macros</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">flow</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">use</span><span style="color:#FFCB6B;"> sentinel_rs</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">utils</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">sleep_for_ms</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // Init sentienl configurations</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">sentinel_rs</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">init_default</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">unwrap_or_else</span><span style="color:#89DDFF;">(|</span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sentinel_rs</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">logging</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">error!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{</span><span style="color:#C3E88D;">:?</span><span style="color:#89DDFF;">}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> err</span><span style="color:#89DDFF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">mut</span><span style="color:#A6ACCD;"> handlers </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Vec</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">new</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> _ </span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">..</span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        handlers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">thread</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">spawn</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">move</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">loop</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#82AAFF;">task</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">unwrap_or_else</span><span style="color:#89DDFF;">(|</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">                    // blocked</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#82AAFF;">sleep_for_ms</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> h </span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;"> handlers </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        h</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">expect</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Couldn&#39;t join on the associated thread</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">#[</span><span style="color:#A6ACCD;">flow</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    traffic_type </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Outbound</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    calculate_strategy </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Direct</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    threshold </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> 10</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">0</span></span>
<span class="line"><span style="color:#89DDFF;">)]</span></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">task</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}</span><span style="color:#C3E88D;">: passed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sentinel_rs</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">utils</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">curr_time_millis</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">sleep_for_ms</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>æ‰§è¡Œ <code>cargo run --example macro</code>ï¼ŒQPS ä¼šè¢«é™åˆ¶åœ¨ 10ã€‚</p><h3 id="prometheus-ç›‘æ§" tabindex="-1">Prometheus ç›‘æ§ <a class="header-anchor" href="#prometheus-ç›‘æ§" aria-hidden="true">#</a></h3><p>åˆ†åˆ«æ‰§è¡Œ</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">prometheus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--config.file=./sentinel-rust/examples/exporter/prometheus/prometheus.yml</span></span>
<span class="line"></span></code></pre></div><p>å’Œ</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">cargo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--example</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">prometheus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--features=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">full exporter</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><!----><!----><h3 id="k8s-åŠ¨æ€æ·»åŠ æµæ§è§„åˆ™" tabindex="-1">K8S åŠ¨æ€æ·»åŠ æµæ§è§„åˆ™ <a class="header-anchor" href="#k8s-åŠ¨æ€æ·»åŠ æµæ§è§„åˆ™" aria-hidden="true">#</a></h3><p>æœ¬åœ°æµ‹è¯•æ—¶åˆ†åˆ«æ‰§è¡Œ</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">prometheus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--config.file=./sentinel-rust/examples/exporter/prometheus/prometheus.yml</span></span>
<span class="line"></span></code></pre></div><p>å’Œ</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">cargo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--example</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">k8s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--features=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">full ds_k8s async</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--nocapture</span></span>
<span class="line"></span></code></pre></div><p>å°†ä¼šçœ‹åˆ°åŠ¨æ€åŠ è½½çš„æµæ§è§„åˆ™ã€‚æ‰§è¡Œ</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">api-resources</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">flowresources</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-A</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥æŸ¥è¯¢åˆ°ç›¸åº”çš„ sentinel flow rule resourcesï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">NAME           APIVERSION                            NAMESPACED   KIND</span></span>
<span class="line"><span style="color:#A6ACCD;">flowresources  rust.datasource.sentinel.io/v1alpha1  true         FlowResource</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">NAMESPACE     NAME     AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">default       flow-1   40s</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="æ›´å¤šç¤ºä¾‹" tabindex="-1">æ›´å¤šç¤ºä¾‹ <a class="header-anchor" href="#æ›´å¤šç¤ºä¾‹" aria-hidden="true">#</a></h3><p>é¡¹ç›®ä¸­çš„ <code>example</code> ç›®å½•æä¾›äº†å¤§é‡ç¤ºä¾‹ç¨‹åºå’Œå‚æ•°è®¾ç½®å‚è€ƒã€‚</p><h2 id="sentinel-rust-ç›¸å…³èµ„æº" tabindex="-1">Sentinel-Rust ç›¸å…³èµ„æº <a class="header-anchor" href="#sentinel-rust-ç›¸å…³èµ„æº" aria-hidden="true">#</a></h2><p><a href="https://github.com/sentinel-group/sentinel-rust/wiki" target="_blank" rel="noreferrer">ä½¿ç”¨æŒ‡å—</a><a href="https://docs.rs/sentinel-core/latest/sentinel_core/" target="_blank" rel="noreferrer"> API æ–‡æ¡£</a><a href="https://github.com/sentinel-group/sentinel-rust/tree/main/examples" target="_blank" rel="noreferrer">ç¤ºä¾‹ä»£ç </a></p></div></div></main><!--[--><!--]--><!----><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div><!----><footer data-v-4f0db67d> Powered by <a href="https://github.com/forsworns/" target="_blank" title="Author" data-v-4f0db67d>Peihao Yang</a> | Copyright Â© 2019-2024 | MIT License </footer><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"2f7c8e6d\",\"about-me_index.md\":\"50a7fd24\",\"zh_about-me_index.md\":\"3438dbc1\",\"zh_blogs_20190721_index.md\":\"10f0e8d3\",\"zh_blogs_20190901_index.md\":\"4969e103\",\"zh_blogs_20190824_index.md\":\"2795144e\",\"zh_blogs_20190919_index.md\":\"131308a4\",\"zh_blogs_20190908_index.md\":\"aa978c5d\",\"zh_blogs_20191109_index.md\":\"734ece8e\",\"zh_blogs_20191112_index.md\":\"be35eb8d\",\"zh_blogs_20200818_index.md\":\"4cb28596\",\"zh_blogs_20200616_index.md\":\"8c23781d\",\"zh_blogs_20220105_index.md\":\"089b7018\",\"zh_blogs_20210123_index.md\":\"dec473ed\",\"zh_blogs_20210120_index.md\":\"9852c362\",\"zh_blogs_20211210_index.md\":\"812f9415\",\"zh_blogs_20210203_index.md\":\"a4bde106\",\"zh_blogs_20221024_index.md\":\"384e3d91\",\"zh_blogs_20211130_index.md\":\"90b7d290\",\"zh_blogs_20220316_index.md\":\"4c7b0595\",\"zh_blogs_20220611_index.md\":\"29bcc8c6\",\"zh_blogs_20230201_index.md\":\"18961a12\",\"zh_blogs_20221108_index.md\":\"7c5dd335\",\"zh_blogs_20230125_index.md\":\"16133594\",\"zh_blogs_20240215_index.md\":\"07a2f642\",\"zh_blogs_20230201_repost.md\":\"5559636b\",\"zh_blogs_20230209_index.md\":\"fcd35ea7\",\"zh_blogs_20230601_index.md\":\"2764358f\",\"zh_blogs_20230126_index.md\":\"da6e13bd\",\"zh_blogs_20221228_index.md\":\"85ebe765\",\"zh_blogs_20200817_index.md\":\"182050d2\",\"zh_blogs_tags_index.md\":\"bb1cad9b\",\"zh_blogs_index.md\":\"8827a540\",\"zh_blogs_20230322_index.md\":\"907a1a46\",\"zh_blogs_20210430_index.md\":\"fd9dc342\",\"zh_index.md\":\"7f69025e\",\"zh_blogs_20210226_index.md\":\"277b2a90\",\"zh_blogs_20210223_index.md\":\"3a0e9df7\",\"zh_blogs_20200816_index.md\":\"ed04d41e\",\"zh_blogs_20210412_index.md\":\"f468b728\",\"zh_blogs_20210311_index.md\":\"ca895dbd\",\"zh_blogs_20210822_index.md\":\"c2600a4e\",\"zh_blogs_20201023_index.md\":\"f4cb8c33\",\"zh_blogs_20210312_index.md\":\"8d088ad3\",\"zh_blogs_20210801_index.md\":\"b801380e\",\"zh_blogs_20210310_index.md\":\"9679a983\",\"zh_blogs_20210627_index.md\":\"f67ac6b4\",\"zh_blogs_20210315_index.md\":\"ed36db20\",\"zh_blogs_20210329_index.md\":\"026b87cf\",\"zh_blogs_20210715_index.md\":\"9e2a57bb\",\"zh_blogs_20230101_index.md\":\"c67a9604\",\"zh_blogs_20230121_index.md\":\"4f94f274\",\"zh_blogs_20220101_index.md\":\"8a30fe99\",\"zh_blogs_20211002_index.md\":\"617b22f2\",\"zh_blogs_20210224_index.md\":\"05490303\",\"zh_blogs_20211120_index.md\":\"4e4f89ba\",\"zh_blogs_20210506_index.md\":\"353f317d\",\"zh_blogs_20240128_index.md\":\"c1691b62\",\"zh_blogs_20210728_index.md\":\"bd248bd4\",\"zh_blogs_20210706_index.md\":\"078a3e97\",\"zh_blogs_20210409_index.md\":\"4d81c46c\",\"zh_blogs_20210204_index.md\":\"28575abe\",\"zh_blogs_20191102_index.md\":\"1845e492\",\"zh_blogs_20220224_index.md\":\"0b83ee1e\",\"zh_blogs_20191103_index.md\":\"fd6e048d\"}")</script>
    <script type="module" async src="/assets/app.0404ad13.js"></script>
    
  </body>
</html>